<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>FreeIPA Installation and configuration | Vignesh Ragupathy</title>
<meta name="keywords" content="linux, opensource">
<meta name="description" content="I worked on a freelance project a year ago which gives me experience in Free IPA server. Here I am sharing some portion of the setup used.It would be useful for beginners trying to setup Free IPA server.
I have 2 sections here. One is about FreeIPA on the normal server and the other is FreeIPA in Docker container.
If you have any questions &amp; comments, feel free to add in the Disqus comment section below">
<meta name="author" content="Vignesh Ragupathy">
<link rel="canonical" href="http://localhost:1313/posts/2017-10-07-freeipa_installation_configuration/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2017-10-07-freeipa_installation_configuration/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/2017-10-07-freeipa_installation_configuration/">
  <meta property="og:site_name" content="Vignesh Ragupathy">
  <meta property="og:title" content="FreeIPA Installation and configuration">
  <meta property="og:description" content="I worked on a freelance project a year ago which gives me experience in Free IPA server. Here I am sharing some portion of the setup used.It would be useful for beginners trying to setup Free IPA server.
I have 2 sections here. One is about FreeIPA on the normal server and the other is FreeIPA in Docker container.
If you have any questions &amp; comments, feel free to add in the Disqus comment section below">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2017-10-07T11:58:00+00:00">
    <meta property="article:modified_time" content="2017-10-07T11:58:00+00:00">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Opensource">
      <meta property="og:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:title" content="FreeIPA Installation and configuration">
<meta name="twitter:description" content="I worked on a freelance project a year ago which gives me experience in Free IPA server. Here I am sharing some portion of the setup used.It would be useful for beginners trying to setup Free IPA server.
I have 2 sections here. One is about FreeIPA on the normal server and the other is FreeIPA in Docker container.
If you have any questions &amp; comments, feel free to add in the Disqus comment section below">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "FreeIPA Installation and configuration",
      "item": "http://localhost:1313/posts/2017-10-07-freeipa_installation_configuration/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "FreeIPA Installation and configuration",
  "name": "FreeIPA Installation and configuration",
  "description": "I worked on a freelance project a year ago which gives me experience in Free IPA server. Here I am sharing some portion of the setup used.It would be useful for beginners trying to setup Free IPA server.\nI have 2 sections here. One is about FreeIPA on the normal server and the other is FreeIPA in Docker container.\nIf you have any questions \u0026amp; comments, feel free to add in the Disqus comment section below\n",
  "keywords": [
    "linux", "opensource"
  ],
  "articleBody": "I worked on a freelance project a year ago which gives me experience in Free IPA server. Here I am sharing some portion of the setup used.It would be useful for beginners trying to setup Free IPA server.\nI have 2 sections here. One is about FreeIPA on the normal server and the other is FreeIPA in Docker container.\nIf you have any questions \u0026 comments, feel free to add in the Disqus comment section below\nFreeIPA stands for Free Identity, Policy, Audit. It is an open source alternative to AD that combines LDAP, Kerberos, CA services and management tools, and ships with its own schemas. It is a solution for managing users, groups, hosts, services, DNS, NTP etc.\nHostname used: IPA server name: freeipa.vikki.in\nIPA client name: client01.vikki.in (should be under the same domain e.g.: xxx.vikki.in)\nDocker host machine: fedora25.vikki.in\nFreeIPA server Installation and Configuration Step 1: Set fully qualified hostname\n{% highlight console %}\n#vim /etc/hostname freeipa.vikki.in\n{% endhighlight %}\nStep 2: Set local resolver for the hostname\n{% highlight console %}\n#vim /etc/hosts 10.0.0.1 freeipa.vikki.in freeipa\n{% endhighlight %}\nStep 3: Disable selinux(optional)\n{% highlight console %}\n#vim /etc/sysconfig/selinux SELINUX=disabled\n{% endhighlight %}\nStep 4: Reboot server\n{% highlight console %}\nreboot {% endhighlight %}\nStep 5: Verify hostname and selinux\n{% highlight console %}\n#hostname freeipa.vikki.in #getenforce Disabled\n{% endhighlight %}\nStep 6: Install ipa server\n{% highlight console %}\nyum install -y ipa-server bind bind-dyndb-ldap ipa-server-dns {% endhighlight %}\nStep 7: Configure FreeIPA\nIf you have a separate DNS server for managing the domain remove the option(–setup-dns)\n{% highlight console %}\nipa-server-install –setup-dns Existing BIND configuration detected, overwrite? [no]: yes Enter the fully qualified domain name of the computer on which you’re setting up server software. Using the form . Example: master.example.com. Server host name [freeipa.vikki.in]: freeipa.vikki.in Please confirm the domain name [vikki.in]: vikki.in Please provide a realm name [VIKKI.IN]: VIKKI.IN Directory Manager password: Password (confirm): IPA admin password: Password (confirm): Do you want to configure DNS forwarders? [yes]: yes Enter the IP address of DNS forwarder to use, or press Enter to finish. Enter IP address for a DNS forwarder: 8.8.8.8 DNS forwarder 8.8.8.8 added Enter IP address for a DNS forwarder: 8.8.4.4 DNS forwarder 8.8.4.4 added Enter IP address for a DNS forwarder: Do you want to configure the reverse zone? [yes]: yes Please specify the reverse zone name [0.0.10.in-addr.arpa.]: 0.0.10.in-addr.arpa Using reverse zone 0.0.10.in-addr.arpa. The IPA Master Server will be configured with: Hostname: freeipa.vikki.in IP address: 10.0.0.1 Domain name: vikki.in Realm name: VIKKI.IN BIND DNS server will be configured to serve IPA domain with: Forwarders: 8.8.8.8, 8.8.4.4 Reverse zone: 0.0.10.in-addr.arpa. Continue to configure the system with these values? [no]: yes The following operations may take some minutes to complete. Please wait until the prompt is returned. Configuring NTP daemon (ntpd) [1/4]: stopping ntpd [2/4]: writing configuration [3/4]: configuring ntpd to start on boot [4/4]: starting ntpd Done configuring NTP daemon (ntpd). Configuring directory server (dirsrv). Estimated time: 1 minute [1/42]: creating directory server user [2/42]: creating directory server instance [3/42]: adding default schema [4/42]: enabling memberof plugin [5/42]: enabling winsync plugin [6/42]: configuring replication version plugin [7/42]: enabling IPA enrollment plugin [8/42]: enabling ldapi [9/42]: configuring uniqueness plugin [10/42]: configuring uuid plugin [11/42]: configuring modrdn plugin [12/42]: configuring DNS plugin [13/42]: enabling entryUSN plugin [14/42]: configuring lockout plugin [15/42]: creating indices [16/42]: enabling referential integrity plugin [17/42]: configuring certmap.conf [18/42]: configure autobind for root [19/42]: configure new location for managed entries [20/42]: configure dirsrv ccache [21/42]: enable SASL mapping fallback [22/42]: restarting directory server [23/42]: adding default layout [24/42]: adding delegation layout [25/42]: creating container for managed entries [26/42]: configuring user private groups [27/42]: configuring netgroups from hostgroups [28/42]: creating default Sudo bind user [29/42]: creating default Auto Member layout [30/42]: adding range check plugin [31/42]: creating default HBAC rule allow_all [32/42]: adding entries for topology management [33/42]: initializing group membership [34/42]: adding master entry [35/42]: initializing domain level [36/42]: configuring Posix uid/gid generation [37/42]: adding replication acis [38/42]: enabling compatibility plugin [39/42]: activating sidgen plugin [40/42]: activating extdom plugin [41/42]: tuning directory server [42/42]: configuring directory to start on boot Done configuring directory server (dirsrv). Configuring certificate server (pki-tomcatd). Estimated time: 3 minutes 30 seconds [1/27]: creating certificate server user [2/27]: configuring certificate server instance [3/27]: stopping certificate server instance to update CS.cfg [4/27]: backing up CS.cfg [5/27]: disabling nonces [6/27]: set up CRL publishing [7/27]: enable PKIX certificate path discovery and validation [8/27]: starting certificate server instance [9/27]: creating RA agent certificate database [10/27]: importing CA chain to RA certificate database [11/27]: fixing RA database permissions [12/27]: setting up signing cert profile [13/27]: setting audit signing renewal to 2 years [14/27]: restarting certificate server [15/27]: requesting RA certificate from CA [16/27]: issuing RA agent certificate [17/27]: adding RA agent as a trusted user [18/27]: authorizing RA to modify profiles [19/27]: configure certmonger for renewals [20/27]: configure certificate renewals [21/27]: configure RA certificate renewal [22/27]: configure Server-Cert certificate renewal [23/27]: Configure HTTP to proxy connections [24/27]: restarting certificate server [25/27]: migrating certificate profiles to LDAP [26/27]: importing IPA certificate profiles [27/27]: adding default CA ACL Done configuring certificate server (pki-tomcatd). Configuring directory server (dirsrv). Estimated time: 10 seconds [1/3]: configuring ssl for ds instance [2/3]: restarting directory server [3/3]: adding CA certificate entry Done configuring directory server (dirsrv). Configuring Kerberos KDC (krb5kdc). Estimated time: 30 seconds [1/10]: adding sasl mappings to the directory [2/10]: adding kerberos container to the directory [3/10]: configuring KDC [4/10]: initialize kerberos container [5/10]: adding default ACIs [6/10]: creating a keytab for the directory [7/10]: creating a keytab for the machine [8/10]: adding the password extension to the directory [9/10]: starting the KDC [10/10]: configuring KDC to start on boot Done configuring Kerberos KDC (krb5kdc). Configuring kadmin [1/2]: starting kadmin [2/2]: configuring kadmin to start on boot Done configuring kadmin. Configuring ipa_memcached [1/2]: starting ipa_memcached [2/2]: configuring ipa_memcached to start on boot Done configuring ipa_memcached. Configuring ipa-otpd [1/2]: starting ipa-otpd [2/2]: configuring ipa-otpd to start on boot Done configuring ipa-otpd. Configuring the web interface (httpd). Estimated time: 1 minute [1/19]: setting mod_nss port to 443 [2/19]: setting mod_nss protocol list to TLSv1.0 - TLSv1.2 [3/19]: setting mod_nss password file [4/19]: enabling mod_nss renegotiate [5/19]: adding URL rewriting rules [6/19]: configuring httpd [7/19]: configure certmonger for renewals [8/19]: setting up ssl [9/19]: importing CA certificates from LDAP [10/19]: setting up browser autoconfig [11/19]: publish CA cert [12/19]: creating a keytab for httpd [13/19]: clean up any existing httpd ccache [14/19]: configuring SELinux for httpd [15/19]: create KDC proxy user [16/19]: create KDC proxy config [17/19]: enable KDC proxy [18/19]: restarting httpd [19/19]: configuring httpd to start on boot Done configuring the web interface (httpd). Applying LDAP updates Upgrading IPA: [1/9]: stopping directory server [2/9]: saving configuration [3/9]: disabling listeners [4/9]: enabling DS global lock [5/9]: starting directory server [6/9]: upgrading server [7/9]: stopping directory server [8/9]: restoring configuration [9/9]: starting directory server Done. Restarting the directory server Restarting the KDC Configuring DNS (named) [1/12]: generating rndc key file WARNING: Your system is running out of entropy, you may experience long delays [2/12]: adding DNS container [3/12]: setting up our zone [4/12]: setting up reverse zone [5/12]: setting up our own record [6/12]: setting up records for other masters [7/12]: adding NS record to the zones [8/12]: setting up CA record [9/12]: setting up kerberos principal [10/12]: setting up named.conf [11/12]: configuring named to start on boot [12/12]: changing resolv.conf to point to ourselves Done configuring DNS (named). Configuring DNS key synchronization service (ipa-dnskeysyncd) [1/7]: checking status [2/7]: setting up bind-dyndb-ldap working directory [3/7]: setting up kerberos principal [4/7]: setting up SoftHSM [5/7]: adding DNSSEC containers [6/7]: creating replica keys [7/7]: configuring ipa-dnskeysyncd to start on boot Done configuring DNS key synchronization service (ipa-dnskeysyncd). Restarting ipa-dnskeysyncd Restarting named Restarting the web server Setup complete Next steps:\nYou must make sure these network ports are open: TCP Ports: 80, 443: HTTP/HTTPS 389, 636: LDAP/LDAPS 88, 464: kerberos 53: bind UDP Ports: 88, 464: kerberos 53: bind 123: ntp You can now obtain a kerberos ticket using the command: ‘kinit admin’ This ticket will allow you to use the IPA tools (e.g., ipa user-add) and the web user interface. Be sure to back up the CA certificate stored in /root/cacert.p12 This file is required to create replicas. The password for this file is the Directory Manager password {% endhighlight %}\nStep 8: Configure firewall\n{% highlight console %}\n#firewall-cmd –permanent –add-service=ntp #firewall-cmd –permanent –add-service=http #firewall-cmd –permanent –add-service=https #firewall-cmd –permanent –add-service=ldap #firewall-cmd –permanent –add-service=ldaps #firewall-cmd –permanent –add-service=kerberos #firewall-cmd –permanent –add-service=kpasswd\n{% endhighlight %}\nEither add all the above rules in firewall or simply flush all rules from iptables(not recommended in production)\n{% highlight console %}\niptables -F {% endhighlight %}\nStep 9: Get Kerberos tickets\nNow the FreeIPA server is ready , we should generate the kerberos ticket with admin privilege. This kerberos ticket is needed to run any IPA commands in server with full privileges and to connect web UI.\nKerberos provides authentication services for entire FreeIPA components.\n{% highlight console %}\n#kinit admin Password for admin@VIKKI.IN:# IPA admin password\n{% endhighlight %}\nWe can also view the current Kerberos ticket with expiry details using the klist command. The default expiry period is 24hours.\n{% highlight console %}\nklist Ticket cache: KEYRING:persistent:0:0 Default principal: admin@VIKKI.IN Valid starting Expires Service principal 08/09/2016 14:45:53 11/09/2016 14:45:50 krbtgt/ADMIN@VIKKI.IN\n{% endhighlight %}\nstep 10: Enabled home directory and default shell\nWe have to enable the home directory creation and default login shell for the new user login. Run the below command to set it.\n{% highlight console %}\nipa config-mod –defaultshell=/bin/bash authconfig –enablemkhomedir –update {% endhighlight %}\nStep 11: Login to freeipa web\nLogin to the freeIPA server from the browser and create some users.\nStep 12: Add dns entry for the IPA client\nNow the user has been created , we can configure the dns record for the new clients to be added under domain vikki.in\n{% highlight console %}\nipa dnsrecord-add vikki.in client01 –a-rec 10.0.0.2 IPA Client\n{% endhighlight %}\nFreeIPA client Installation and Configuration Step 1: Freeipa client preparation\nSet hostname “client01.vikki.in”\nDisable “selinux”\nDisable “Firewall”\nFor all the above follow the same procedure followed in FreeIPA server preparation\nStep 2: Set DNS server IP to FreeIPA server\n{% highlight console %}\nvim /etc/resolv.conf nameserver 10.0.0.1 #dig client01.vikki.in\n{% endhighlight %}\nStep 3: Install ipa client\n{% highlight console %}\nyum -y install ipa-client Discovery was successful! Hostname: client01.vikki.in Realm: VIKKI.IN DNS Domain: vikki.in IPA Server: freeipa.vikki.in BaseDN: dc=vikki,dc=in\nconfirm settings and proceed with “yes” Continue to configure the system with these values? [no]: yes\nanswer with admin User authorized to enroll computers: admin Synchronizing time with KDC… Unable to sync time with IPA NTP server, assuming the time is in sync. Please check that 123 UDP port is opened. Password for admin@vikki.in: Successfully retrieved CA cert Subject: CN=Certificate Authority,O=vikki.in Issuer: CN=Certificate Authority,O=vikki.in Valid From: Fri Mar 20 01:42:15 2015 UTC Valid Until: Tue Mar 20 01:42:15 2035 UTC Enrolled in IPA realm VIKKI.IN ….. ….. Configured /etc/ssh/ssh_config Configured /etc/ssh/sshd_config Client configuration complete.\n{% endhighlight %}\nStep 4: Try to login using the user created from the FreeIPA server GUI\n{% highlight console %}\nssh vivek@client01.vikki.in Password: Password expired. Change your password now. Current Password: New password: Retype new password: Creating home directory for vivek. Last login: Fri Jan 19 18:44:31 2018 from localhost\n{% endhighlight %}{% highlight console %}\npwd /home/vivek\n{% endhighlight %}\nIf you have not enabled the home directory creation and login shell , you will get the below output.\n{% highlight console %}\nssh vivek@client01.vikki.in Password: Password expired. Change your password now. Current Password: New password: Retype new password: Could not chdir to home directory /home/vivek: No such file or directory -sh-4.2$\n{% endhighlight %}\nFreeIPA in Docker container FreeIPA is also available as a docker container. We can download the FreeIPA repository from github master.zip.\nHow to build FreeIPA docker container Download the zip file, extract it , go inside the directory and run the docker build.\nThis repository has “Dockerfile” which supports many operation system, use the one you required. Here i am installing the container in Fedora27 , so i passing the respective dockerfile using “-f” option.\n{% highlight console %}\n[root@fedora25 freeipa-container-master]# docker build -t freeipa-server -f Dockerfile.fedora-27 . Sending build context to Docker daemon 161.3 kB Step 1/45 : FROM registry.fedoraproject.org/fedora:27 Trying to pull repository registry.fedoraproject.org/fedora … sha256:44be9569d32fee1846afd1d17dc681c2b8f1f2b367764194ade32d9bfdf1984f: Pulling from registry.fedoraproject.org/fedora 178a618c1fcb: Pull complete Digest: sha256:44be9569d32fee1846afd1d17dc681c2b8f1f2b367764194ade32d9bfdf1984f Status: Downloaded newer image for registry.fedoraproject.org/fedora:27 —\u003e 9881e4229c95 Step 2/45 : MAINTAINER Jan Pazdziora —\u003e Running in 4ccc52e61959 —\u003e e6203b4f193f Removing intermediate container 4ccc52e61959 Step 3/45 : RUN groupadd -g 288 kdcproxy ; useradd -u 288 -g 288 -c ‘IPA KDC Proxy User’ -d ‘/var/lib/kdcproxy’ -s ‘/sbin/nologin’ kdcproxy —\u003e Running in 281bede2e1ca —\u003e 11f29258686a Removing intermediate container 281bede2e1ca Step 4/45 : RUN groupadd -g 289 ipaapi; useradd -u 289 -g 289 -c ‘IPA Framework User’ -d / -s ‘/sbin/nologin’ ipaapi —\u003e Running in acff04c732af useradd: warning: the home directory already exists. Not copying any file from skel directory into it. —\u003e 9100a9565039 Removing intermediate container acff04c732af Step 5/45 : RUN mkdir -p /run/lock \u0026\u0026 dnf upgrade -y \u0026\u0026 dnf install -y freeipa-server freeipa-server-dns freeipa-server-trust-ad initscripts \u0026\u0026 dnf clean all —\u003e Running in b33a6dd071aa Fedora 27 - x86_64 - Updates 3.2 MB/s | 16 MB 00:05 Fedora 27 - x86_64 3.0 MB/s | 58 MB 00:19 Last metadata expiration check: 0:00:06 ago on Sat Jan 20 06:40:05 2018. Dependencies resolved. Package Arch Version Repository Size Upgrading: gdbm x86_64 1:1.13-6.fc27 updates 158 k\nTransaction Summary Upgrade 1 Package\nTotal download size: 158 k Downloading Packages: gdbm-1.13-6.fc27.x86_64.rpm 198 kB/s | 158 kB 00:00 Total 72 kB/s | 158 kB 00:02 Running transaction check Transaction check succeeded. Running transaction test Transaction test succeeded. Running transaction Preparing : 1/1 Upgrading : gdbm-1:1.13-6.fc27.x86_64 1/2 Running scriptlet: gdbm-1:1.13-6.fc27.x86_64 1/2 Cleanup : gdbm-1.14-1.fc27.x86_64 2/2 Running scriptlet: gdbm-1.14-1.fc27.x86_64 2/2 Verifying : gdbm-1:1.13-6.fc27.x86_64 1/2 Verifying : gdbm-1.14-1.fc27.x86_64 2/2\nUpgraded: gdbm.x86_64 1:1.13-6.fc27\nComplete! Last metadata expiration check: 0:00:38 ago on Sat Jan 20 06:40:05 2018. Dependencies resolved. Package Arch Version Repository Size Installing: freeipa-server x86_64 4.6.1-3.fc27 fedora 398 k freeipa-server-dns noarch 4.6.1-3.fc27 fedora 60 k freeipa-server-trust-ad x86_64 4.6.1-3.fc27 fedora 152 k initscripts x86_64 9.79-1.fc27 updates 394 k Installing dependencies: 389-ds-base x86_64 1.3.7.8-1.fc27 updates 1.8 M 389-ds-base-libs x86_64 1.3.7.8-1.fc27 updates 744 k GeoIP x86_64 1.6.11-3.fc27 fedora 124 k GeoIP-GeoLite-data noarch 2018.01-1.fc27 updates 465 k timedatex x86_64 0.4-5.fc27 fedora 30 k\nTransaction Summary Install 416 Packages\nTotal download size: 184 M Installed size: 568 M Downloading Packages: (1/416): freeipa-server-dns-4.6.1-3.fc27.noarch 103 kB/s | 60 kB 00:00 (2/416): freeipa-server-trust-ad-4.6.1-3.fc27.x 208 kB/s | 152 kB 00:00 (3/416): cyrus-sasl-gssapi-2.1.26-34.fc27.x86_6 286 kB/s | 46 kB 00:00 (4/416): freeipa-server-4.6.1-3.fc27.x86_64.rpm 365 kB/s | 398 kB 00:01 (5/416): freeipa-client-4.6.1-3.fc27.x86_64.rpm 441 kB/s | 159 kB 00:00 (415/416): linux-atm-libs-2.5.1-19.fc27.x86_64. 154 kB/s | 40 kB 00:00 (416/416): libicu-57.1-9.fc27.x86_64.rpm 862 kB/s | 8.4 MB 00:09 Total 2.0 MB/s | 184 MB 01:30 Running transaction check Transaction check succeeded. Running transaction test Transaction test succeeded. Running transaction Running scriptlet: copy-jdk-configs-3.3-2.fc27.noarch 1/1 Running scriptlet: pki-base-10.5.1-1.fc27.noarch 1/1 Running scriptlet: java-1.8.0-openjdk-headless-1:1.8.0.151-1.b12.fc27.x 1/1 Preparing : 1/1 Installing : perl-Exporter-5.72-395.fc27.noarch 1/416 Installing : perl-libs-4:5.26.1-402.fc27.x86_64 2/416 Running scriptlet: perl-libs-4:5.26.1-402.fc27.x86_64 Installing : freetype-2.8-7.fc27.x86_64 215/416 Running scriptlet: opendnssec-1.4.14-1.fc27.x86_64 216/416 Installing : opendnssec-1.4.14-1.fc27.x86_64 216/416 Running scriptlet: opendnssec-1.4.14-1.fc27.x86_64 216/416 The token has been initialized and is reassigned to slot 1739892472 INFO: The XML in /etc/opendnssec/conf.xml is valid INFO: The XML in /etc/opendnssec/zonelist.xml is valid INFO: The XML in /etc/opendnssec/kasp.xml is valid WARNING: In policy default, Y used in duration field for Keys/KSK Lifetime (P1Y) in /etc/opendnssec/kasp.xml - this will be interpreted as 365 days WARNING: In policy lab, Y used in duration field for Keys/KSK Lifetime (P1Y) in /etc/opendnssec/kasp.xml - this will be interpreted as 365 days WARNING This will erase all data in the database; are you sure? [y/N] fixing permissions on file /var/opendnssec/kasp.db zonelist filename set to /etc/opendnssec/zonelist.xml. kasp filename set to /etc/opendnssec/kasp.xml. Repository SoftHSM found No Maximum Capacity set. RequireBackup NOT set; please make sure that you know the potential problems of using keys which are not recoverable Policy default found Info: converting P1Y to seconds; M interpreted as 31 days, Y interpreted as 365 days Policy lab found Info: converting P1Y to seconds; M interpreted as 31 days, Y interpreted as 365 days Installing : net-tools-2.0-0.45.20160912git.fc27.x86_64 416/416 Running scriptlet: libsss_sudo-1.16.0-5.fc27.x86_64 416/416Failed to connect to bus: No such file or directory\nVerifying : freeipa-server-4.6.1-3.fc27.x86_64 1/416 Verifying : freeipa-server-dns-4.6.1-3.fc27.noarch 2/416 Verifying : freeipa-server-trust-ad-4.6.1-3.fc27.x86_64 3/416 Verifying : cyrus-sasl-gssapi-2.1.26-34.fc27.x86_64 Verifying : lua-posix-33.3.1-7.fc27.x86_64 415/416 Verifying : perl-libnet-3.11-1.fc27.noarch 416/416\nInstalled: freeipa-server.x86_64 4.6.1-3.fc27 freeipa-server-dns.noarch 4.6.1-3.fc27 freeipa-server-trust-ad.x86_64 4.6.1-3.fc27\nxsom.noarch 0-17.20110809svn.fc27\nComplete! Non-fatal scriptlet failure in rpm package nfs-utils Non-fatal scriptlet failure in rpm package nfs-utils Non-fatal scriptlet failure in rpm package nfs-utils Non-fatal scriptlet failure in rpm package nfs-utils Non-fatal POSTIN scriptlet failure in rpm package freeipa-server-trust-ad Non-fatal POSTIN scriptlet failure in rpm package freeipa-server-trust-ad 18 files removed —\u003e 8e5982e4aba2 Removing intermediate container b33a6dd071aa Step 6/45 : RUN sed -i ‘/installutils.verify_fqdn(config.master_host_name, options.no_host_dns)/s/)/, local_hostname=False)/’ /usr/lib/python2.7/site-packages/ipaserver/install/server/replicainstall.py \u0026\u0026 python -m compileall /usr/lib/python2.7/site-packages/ipaserver/install/server/replicainstall.py —\u003e Running in 3f16baa3e82f Compiling /usr/lib/python2.7/site-packages/ipaserver/install/server/replicainstall.py … —\u003e 907bee58561a Removing intermediate container 3f16baa3e82f Step 7/45 : RUN sed -i ‘/installutils.verify_fqdn(config.master_host_name, options.no_host_dns)/s/)/, local_hostname=False)/’ /usr/lib/python3.6/site-packages/ipaserver/install/server/replicainstall.py \u0026\u0026 python3 -m compileall /usr/lib/python3.6/site-packages/ipaserver/install/server/replicainstall.py —\u003e Running in c33cb158b26c Compiling ‘/usr/lib/python3.6/site-packages/ipaserver/install/server/replicainstall.py’… —\u003e 0a6e9da4fd27 Removing intermediate container c33cb158b26c Step 8/45 : RUN [-L /etc/systemd/system/syslog.service] \u0026\u0026 ! [-f /etc/systemd/system/syslog.service] \u0026\u0026 rm -f /etc/systemd/system/syslog.service —\u003e Running in d7ef9f4d9b2a —\u003e 9980910fa2dc Removing intermediate container d7ef9f4d9b2a Step 9/45 : RUN find /etc/systemd/system/* ‘!’ -name ‘.wants’ | xargs rm -rvf —\u003e Running in 594660eda1bc removed ‘/etc/systemd/system/basic.target.wants/dnf-makecache.timer’ removed ‘/etc/systemd/system/console-getty.service’ removed ‘/etc/systemd/system/dbus-org.freedesktop.timedate1.service’ removed ‘/etc/systemd/system/default.target’ removed ‘/etc/systemd/system/dev-hugepages.mount’ removed ‘/etc/systemd/system/getty.target’ removed ‘/etc/systemd/system/getty.target.wants/getty@tty1.service’ removed directory ‘/etc/systemd/system/httpd.d’ removed ‘/etc/systemd/system/local-fs.target.wants/fedora-readonly.service’ removed ‘/etc/systemd/system/multi-user.target.wants/remote-fs.target’ removed ‘/etc/systemd/system/multi-user.target.wants/auditd.service’ removed ‘/etc/systemd/system/multi-user.target.wants/nfs-client.target’ removed ‘/etc/systemd/system/multi-user.target.wants/sssd.service’ removed ‘/etc/systemd/system/remote-fs.target.wants/nfs-client.target’ removed ‘/etc/systemd/system/sockets.target.wants/sssd-secrets.socket’ removed ‘/etc/systemd/system/sys-fs-fuse-connections.mount’ removed ‘/etc/systemd/system/sysinit.target.wants/fedora-import-state.service’ removed ‘/etc/systemd/system/systemd-logind.service’ removed ‘/etc/systemd/system/systemd-remount-fs.service’ removed ‘/etc/systemd/system/systemd-timedated.service’ —\u003e 6273c3ce8454 Removing intermediate container 594660eda1bc Step 10/45 : RUN for i in basic.target network.service netconsole.service ; do rm -f /usr/lib/systemd/system/$i \u0026\u0026 ln -s /dev/null /usr/lib/systemd/system/$i ; done —\u003e Running in 3805f0460b62 —\u003e a82df26e2086 Removing intermediate container 3805f0460b62 Step 11/45 : RUN rm -fv /usr/lib/systemd/system/sysinit.target.wants/ —\u003e Running in 2340c6e904de removed ‘/usr/lib/systemd/system/sysinit.target.wants/cryptsetup.target’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/dev-hugepages.mount’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/dev-mqueue.mount’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/ldconfig.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/proc-sys-fs-binfmt_misc.automount’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/sys-fs-fuse-connections.mount’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/sys-kernel-config.mount’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/sys-kernel-debug.mount’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-ask-password-console.path’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-binfmt.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-firstboot.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-journal-catalog-update.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-journal-flush.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-journald.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-machine-id-commit.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-sysctl.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-sysusers.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-tmpfiles-setup.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-update-done.service’ removed ‘/usr/lib/systemd/system/sysinit.target.wants/systemd-update-utmp.service’ —\u003e e575744cbec4 Removing intermediate container 2340c6e904de Step 12/45 : RUN echo ‘disable ’ \u003e /usr/lib/systemd/system-preset/10-container-disable.preset —\u003e Running in c2c372a783c6 —\u003e afbb3fa9de01 Removing intermediate container c2c372a783c6 Step 13/45 : RUN /sbin/ldconfig -X —\u003e Running in d4e981ba0dae —\u003e 18cde0edd362 Removing intermediate container d4e981ba0dae Step 14/45 : COPY init-data /usr/local/sbin/init —\u003e e3cf2eac153f Removing intermediate container b5a7b4f89ee8 Step 15/45 : COPY ipa-server-configure-first ipa-server-status-check exit-with-status ipa-volume-upgrade- /usr/sbin/ —\u003e c60a71108eda Removing intermediate container b38588e0eecc Step 16/45 : COPY install.sh uninstall.sh /bin/ —\u003e d208c2ad0dea Removing intermediate container 633df7d21612 Step 17/45 : RUN mv /bin/hostnamectl /bin/hostnamectl.orig —\u003e Running in d84b0e146325 —\u003e 41a46d7a76d0 Removing intermediate container d84b0e146325 Step 18/45 : RUN mv /usr/bin/domainname /usr/bin/domainname.orig —\u003e Running in 808c9796831e —\u003e bdd853c871b6 Removing intermediate container 808c9796831e Step 19/45 : ADD hostnamectl-wrapper /bin/hostnamectl —\u003e f34600ec54fd Removing intermediate container f6f3c216ffd4 Step 20/45 : ADD hostnamectl-wrapper /usr/bin/domainname —\u003e 49fb7d34f8af Removing intermediate container 3c3c1695eb37 Step 21/45 : RUN chmod -v +x /usr/local/sbin/init /usr/sbin/ipa-server-configure-first /usr/sbin/ipa-server-status-check /usr/sbin/exit-with-status /usr/sbin/ipa-volume-upgrade-* /bin/install.sh /bin/uninstall.sh /bin/hostnamectl /usr/bin/domainname —\u003e Running in c322618dc805 mode of ‘/usr/local/sbin/init’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/sbin/ipa-server-configure-first’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/sbin/ipa-server-status-check’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/sbin/exit-with-status’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/sbin/ipa-volume-upgrade-0.5-0.6’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/sbin/ipa-volume-upgrade-0.5-1.0’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/sbin/ipa-volume-upgrade-0.5-1.1’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/sbin/ipa-volume-upgrade-0.6-1.0’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/sbin/ipa-volume-upgrade-0.6-1.1’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/sbin/ipa-volume-upgrade-1.0-1.1’ retained as 0755 (rwxr-xr-x) mode of ‘/bin/install.sh’ retained as 0755 (rwxr-xr-x) mode of ‘/bin/uninstall.sh’ retained as 0755 (rwxr-xr-x) mode of ‘/bin/hostnamectl’ retained as 0755 (rwxr-xr-x) mode of ‘/usr/bin/domainname’ retained as 0755 (rwxr-xr-x) —\u003e 0395279a17e5 Removing intermediate container c322618dc805 Step 22/45 : COPY container-ipa.target ipa-server-configure-first.service ipa-server-upgrade.service ipa-server-update-self-ip-address.service /usr/lib/systemd/system/ —\u003e b9a4d37d8af7 Removing intermediate container 8218605ec53b Step 23/45 : RUN rmdir -v /etc/systemd/system/multi-user.target.wants \u0026\u0026 mkdir /etc/systemd/system/container-ipa.target.wants \u0026\u0026 ln -s /etc/systemd/system/container-ipa.target.wants /etc/systemd/system/multi-user.target.wants —\u003e Running in d5554f6b4498 rmdir: removing directory, ‘/etc/systemd/system/multi-user.target.wants’ —\u003e ca9aaf468af8 Removing intermediate container d5554f6b4498 Step 24/45 : RUN systemctl set-default container-ipa.target —\u003e Running in 2b40be183177 Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/container-ipa.target. —\u003e 3d9f7251ef3d Removing intermediate container 2b40be183177 Step 25/45 : RUN systemctl enable ipa-server-configure-first.service —\u003e Running in 6a7badce6e3e Created symlink /etc/systemd/system/container-ipa.target.wants/ipa-server-configure-first.service → /usr/lib/systemd/system/ipa-server-configure-first.service. —\u003e 74059555138d Removing intermediate container 6a7badce6e3e Step 26/45 : COPY exit-via-chroot.conf /usr/lib/systemd/system/systemd-poweroff.service.d/ —\u003e 6f481582dd11 Removing intermediate container d704db80e37d Step 27/45 : COPY atomic-install-help /usr/share/ipa/ —\u003e 7f31c6a39572 Removing intermediate container 19f606e9e0bc Step 28/45 : COPY volume-data-list volume-data-mv-list volume-data-autoupdate /etc/ —\u003e b9c4aa387aa4 Removing intermediate container ca6ce5b07075 Step 29/45 : RUN set -e ; cd / ; mkdir /data-template ; cat /etc/volume-data-list | while read i ; do echo $i ; if [-e $i] ; then tar cf - .$i | ( cd /data-template \u0026\u0026 tar xf - ) ; else mkdir -p /data-template$( dirname $i ) ; fi ; mkdir -p $( dirname $i ) ; if [\"$i\" == /var/log/] ; then mv /var/log /var/log-removed ; else rm -rf $i ; fi ; ln -sf /data${i%/} ${i%/} ; done —\u003e Running in 1e849a37ee72 /etc/certmonger/ /etc/dirsrv/ ….. /var/named/data/ /var/named/dynamic/ /var/named/dyndb-ldap/ —\u003e 49bf3153d005 Removing intermediate container 1e849a37ee72 Step 30/45 : RUN rm -rf /var/log-removed —\u003e Running in 35d0bb1e34ac —\u003e 6d13c89ca7b8 Removing intermediate container 35d0bb1e34ac Step 31/45 : RUN sed -i ’s!^d /var/log.*!L /var/log - - - - /data/var/log!’ /usr/lib/tmpfiles.d/var.conf —\u003e Running in 3287ce189368 —\u003e 0fc4ec2c345c Removing intermediate container 3287ce189368 Step 32/45 : RUN mv /usr/lib/tmpfiles.d/journal-nocow.conf /usr/lib/tmpfiles.d/journal-nocow.conf.disabled —\u003e Running in 07849f109455 —\u003e d80610223617 Removing intermediate container 07849f109455 Step 33/45 : RUN rm -f /data-template/var/lib/systemd/random-seed —\u003e Running in b009e068aa00 —\u003e 3aa621b575ae Removing intermediate container b009e068aa00 Step 34/45 : RUN echo 1.1 \u003e /etc/volume-version —\u003e Running in a9e66d69544f —\u003e 05d2ab591923 Removing intermediate container a9e66d69544f Step 35/45 : ENV container docker —\u003e Running in 27b114bb9901 —\u003e 3b927b73f0db Removing intermediate container 27b114bb9901 Step 36/45 : EXPOSE 53/udp 53 80 443 389 636 88 464 88/udp 464/udp 123/udp 7389 9443 9444 9445 —\u003e Running in da76877790e9 —\u003e 40e09ab03c05 Removing intermediate container da76877790e9 Step 37/45 : VOLUME /tmp /run /data /var/log/journal —\u003e Running in 0ea0157b1149 —\u003e 81126c6e8057 Removing intermediate container 0ea0157b1149 Step 38/45 : STOPSIGNAL RTMIN+3 —\u003e Running in 0829533a8567 —\u003e 0d9947067ebe Removing intermediate container 0829533a8567 Step 39/45 : ENTRYPOINT /usr/local/sbin/init —\u003e Running in 3f6c0821043f —\u003e 31def441bb06 Removing intermediate container 3f6c0821043f Step 40/45 : RUN uuidgen \u003e /data-template/build-id —\u003e Running in 70183a84ee14 —\u003e dbb914132b5f Removing intermediate container 70183a84ee14 Step 41/45 : LABEL install ‘docker run -ti –rm –privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} -e NAME=${NAME} -e IMAGE=${IMAGE} ${IMAGE} /bin/install.sh’ —\u003e Running in 6deca08f490d —\u003e 5fed892b4df7 Removing intermediate container 6deca08f490d Step 42/45 : LABEL run ‘docker run ${RUN_OPTS} –name ${NAME} -v /var/lib/${NAME}:/data:Z -v /sys/fs/cgroup:/sys/fs/cgroup:ro –tmpfs /run –tmpfs /tmp -v /dev/urandom:/dev/random:ro ${IMAGE}’ —\u003e Running in 7c26df7faabc —\u003e 686f0db1737b Removing intermediate container 7c26df7faabc Step 43/45 : LABEL RUN_OPTS_FILE ‘/var/lib/${NAME}/docker-run-opts’ —\u003e Running in 7ecd298291f9 —\u003e 6070645145b8 Removing intermediate container 7ecd298291f9 Step 44/45 : LABEL stop ‘docker stop ${NAME}’ —\u003e Running in 7303fefc3b5c —\u003e b43a46e901d8 Removing intermediate container 7303fefc3b5c Step 45/45 : LABEL uninstall ‘docker run –rm –privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} ${IMAGE} /bin/uninstall.sh’ —\u003e Running in bf4fb0f57293 —\u003e e17fec1f8cf2 Removing intermediate container bf4fb0f57293 Successfully built e17fec1f8cf2\n{% endhighlight %}\nOnce the repository is build, we can verify the images in docker.The docker image we created is freeipa-server showing below\n{% highlight console %}\n[root@fedora25 freeipa-container-master]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE freeipa-server latest e17fec1f8cf2 10 minutes ago 855 MB registry.fedoraproject.org/fedora 27 9881e4229c95 47 hours ago 252 MB docker.io/freeipa/freeipa-server latest c1ab4ccd4cbc 7 days ago 795 MB\n{% endhighlight %}\nHow to run the FreeIPA docker container Now before running the container. Create a directory(used as a volume in docker instance) and set the necessary permission\n{% highlight console %}\n[root@fedora25 freeipa-container-master]# mkdir /var/lib/ipa-data\n{% endhighlight %}{% highlight console %}\n[root@fedora25 freeipa-container-master]# setsebool -P container_manage_cgroup 1 [root@fedora25 freeipa-container-master]# chmod 777 /var/lib/ipa-data\n{% endhighlight %}\nIf you need to access the docker container outside the host, you should map the container ports with host ports using option -p 53:53/udp -p 53:53 -p 80:80 -p 443:443 -p 389:389 -p 636:636 -p 88:88 -p 464:464 -p 88:88/udp -p 464:464/udp -p 123:123/udp -p 7389:7389 -p 9443:9443 -p 9444:9444 -p 9445:9445. But here of for testing i am doing the default install\nNow start run the docker\n{% highlight console %}\n[root@fedora25 freeipa-container-master]# docker run –name freeipa-server-container -ti -h freeipa.vikki.in -v /sys/fs/cgroup:/sys/fs/cgroup:ro –tmpfs /run –tmpfs /tmp -v /var/lib/ipa-data:/data:Z freeipa-server systemd 234 running in system mode. (+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD -IDN2 +IDN default-hierarchy=hybrid) Detected virtualization docker. Detected architecture x86-64. Set hostname to . Initializing machine ID from random generator. system.slice: Failed to set invocation ID on control group /system.slice/docker-30667326bf93d1776a13acc7f395167f87aeb44326f4785e51c851bf35a1f46f.scope/system.slice, ignoring: Operation not permitted systemd-journald.service: Failed to set invocation ID on control group /system.slice/docker-30667326bf93d1776a13acc7f395167f87aeb44326f4785e51c851bf35a1f46f.scope/system.slice/systemd-journald.service, ignoring: Operation not permitted systemd-tmpfiles-setup.service: Failed to set invocation ID on control group /system.slice/docker-30667326bf93d1776a13acc7f395167f87aeb44326f4785e51c851bf35a1f46f.scope/system.slice/systemd-tmpfiles-setup.service, ignoring: Operation not permitted Sat Jan 20 07:09:58 UTC 2018 /usr/sbin/ipa-server-configure-first\nThe log file for this installation can be found in /var/log/ipaserver-install.log This program will set up the FreeIPA Server.\nThis includes:\nConfigure a stand-alone CA (dogtag) for certificate management Configure the Network Time Daemon (ntpd) Create and configure an instance of Directory Server Create and configure a Kerberos Key Distribution Center (KDC) Configure Apache (httpd) Configure the KDC to enable PKINIT To accept the default shown in brackets, press the Enter key.\nDo you want to configure integrated DNS (BIND)? [no]:\nEnter the fully qualified domain name of the computer on which you’re setting up server software. Using the form . Example: master.example.com.\nServer host name [freeipa.vikki.in]:\nThe domain name has been determined based on the host name.\nPlease confirm the domain name [vikki.in]:\nThe kerberos protocol requires a Realm name to be defined. This is typically the domain name converted to uppercase.\nPlease provide a realm name [VIKKI.IN]: Certain directory server operations require an administrative user. This user is referred to as the Directory Manager and has full access to the Directory for system management tasks and will be added to the instance of directory server created for IPA. The password must be at least 8 characters long.\nDirectory Manager password: Password (confirm):\nThe IPA server requires an administrative user, named ‘admin’. This user is a regular system account used for IPA server administration.\nIPA admin password: Password (confirm):\nThe IPA Master Server will be configured with: Hostname: freeipa.vikki.in IP address(es): 172.17.0.2 Domain name: vikki.in Realm name: VIKKI.IN\nContinue to configure the system with these values? [no]: yes\nThe following operations may take some minutes to complete. Please wait until the prompt is returned.\nConfiguring NTP daemon (ntpd) [1/4]: stopping ntpd [2/4]: writing configuration [3/4]: configuring ntpd to start on boot [4/4]: starting ntpd Done configuring NTP daemon (ntpd). Configuring directory server (dirsrv). Estimated time: 30 seconds [1/45]: creating directory server instance [2/45]: enabling ldapi [3/45]: configure autobind for root ….\n[45/45]: configuring directory to start on boot Done configuring directory server (dirsrv). Configuring Kerberos KDC (krb5kdc) [1/10]: adding kerberos container to the directory [2/10]: configuring KDC [3/10]: initialize kerberos container …. [28/29]: adding ‘ipa’ CA entry [29/29]: configuring certmonger renewal for lightweight CAs Done configuring certificate server (pki-tomcatd). Configuring directory server (dirsrv) [1/3]: configuring TLS for DS instance [2/3]: adding CA certificate entry [3/3]: restarting directory server Done configuring directory server (dirsrv). Configuring ipa-otpd [1/2]: starting ipa-otpd [2/2]: configuring ipa-otpd to start on boot Done configuring ipa-otpd. Configuring ipa-custodia [1/5]: Generating ipa-custodia config file [2/5]: Making sure custodia container exists [3/5]: Generating ipa-custodia keys [4/5]: starting ipa-custodia [5/5]: configuring ipa-custodia to start on boot Done configuring ipa-custodia. Configuring the web interface (httpd) [1/22]: stopping httpd [2/22]: setting mod_nss port to 443 …. [22/22]: enabling oddjobd Done configuring the web interface (httpd). Configuring Kerberos KDC (krb5kdc) [1/1]: installing X509 Certificate for PKINIT Done configuring Kerberos KDC (krb5kdc). Applying LDAP updates Upgrading IPA:. Estimated time: 1 minute 30 seconds [1/9]: stopping directory server ….. [9/9]: starting directory server Done. Restarting the KDC ipaserver.dns_data_management: ERROR unable to resolve host name freeipa.vikki.in. to IP address, ipa-ca DNS record will be incomplete Please add records in this file to your DNS system: /tmp/ipa.system.records.dc9aakkj.db Configuring client side components Using existing certificate ‘/etc/ipa/ca.crt’. Client hostname: freeipa.vikki.in Realm: VIKKI.IN DNS Domain: vikki.in IPA Server: freeipa.vikki.in BaseDN: dc=vikki,dc=in\nSkipping synchronizing time with NTP server. New SSSD config will be created Configured sudoers in /etc/nsswitch.conf Configured /etc/sssd/sssd.conf trying https://freeipa.vikki.in/ipa/json [try 1]: Forwarding ‘schema’ to json server ‘https://freeipa.vikki.in/ipa/json' trying https://freeipa.vikki.in/ipa/session/json [try 1]: Forwarding ‘ping’ to json server ‘https://freeipa.vikki.in/ipa/session/json' [try 1]: Forwarding ‘ca_is_enabled’ to json server ‘https://freeipa.vikki.in/ipa/session/json' Systemwide CA database updated. SSSD enabled Configured /etc/openldap/ldap.conf /etc/ssh/ssh_config not found, skipping configuration /etc/ssh/sshd_config not found, skipping configuration Configuring vikki.in as NIS domain. Client configuration complete. The ipa-client-install command was successful\n============================================================================== Setup complete\nNext steps:\nYou must make sure these network ports are open: TCP Ports:\n80, 443: HTTP/HTTPS 389, 636: LDAP/LDAPS 88, 464: kerberos UDP Ports: 88, 464: kerberos 123: ntp You can now obtain a kerberos ticket using the command: ‘kinit admin’ This ticket will allow you to use the IPA tools (e.g., ipa user-add) and the web user interface.\nKerberos requires time synchronization between clients and servers for correct operation. You should consider enabling ntpd.\nBe sure to back up the CA certificates stored in /root/cacert.p12 These files are required to create replicas. The password for these files is the Directory Manager password FreeIPA server does not run DNS server, skipping update-self-ip-address. Created symlink /etc/systemd/system/container-ipa.target.wants/ipa-server-update-self-ip-address.service → /usr/lib/systemd/system/ipa-server-update-self-ip-address.service. Created symlink /etc/systemd/system/container-ipa.target.wants/ipa-server-upgrade.service → /usr/lib/systemd/system/ipa-server-upgrade.service. Removed /etc/systemd/system/container-ipa.target.wants/ipa-server-configure-first.service. FreeIPA server configured.\n{% endhighlight %}\nNow the FreeIPA docker container is ready. Verify the status of running container.\n{% highlight console %}\n[root@fedora25 ~]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 30667326bf93 freeipa-server “/usr/local/sbin/init” 45 minutes ago Up 44 minutes 53/tcp, 80/tcp, 53/udp, 88/udp, 88/tcp, 389/tcp, 443/tcp, 123/udp, 464/tcp, 636/tcp, 7389/tcp, 9443-9445/tcp, 464/udp freeipa-server-container\n{% endhighlight %}\nHow to enroll the host to FreeIPA running in container We can also enroll the host to FreeIPA server running in container.Since i don’t have DNS configured, i manually added the FreeIPA docker container IP to the local resolver file in host machine.\n{% highlight console %}\n[root@fedora25 ~]# docker inspect –format ‘{{.NetworkSettings.IPAddress}}’ 1freeipa-server-container 172.17.0.2 [root@fedora25 ~]# cat /etc/hosts |grep freeipa 172.17.0.2 freeipa.vikki.in\n{% endhighlight %}\nNow install the ipa client in fedora host machine.\n{% highlight console %}\n[root@fedora25 ~]# ipa-client-install WARNING: ntpd time\u0026date synchronization service will not be configured as conflicting service (chronyd) is enabled Use –force-ntpd option to disable it and force configuration of ntpd\nDNS discovery failed to determine your DNS domain Provide the domain name of your IPA server (ex: example.com): vikki.in Provide your IPA server name (ex: ipa.example.com): freeipa.vikki.in The failure to use DNS to find your IPA server indicates that your resolv.conf file is not properly configured. Autodiscovery of servers for failover cannot work with this configuration. If you proceed with the installation, services will be configured to always access the discovered server for all operations and will not fail over to other servers in case of failure. Proceed with fixed values and no DNS discovery? [no]: yes Client hostname: fedora25.vikki.in Realm: VIKKI.IN DNS Domain: vikki.in IPA Server: freeipa.vikki.in BaseDN: dc=vikki,dc=in\nContinue to configure the system with these values? [no]: yes Skipping synchronizing time with NTP server. User authorized to enroll computers: admin Password for admin@VIKKI.IN: Successfully retrieved CA cert Subject: CN=Certificate Authority,O=VIKKI.IN Issuer: CN=Certificate Authority,O=VIKKI.IN Valid From: 2018-01-20 07:13:00 Valid Until: 2038-01-20 07:13:00\nEnrolled in IPA realm VIKKI.IN Created /etc/ipa/default.conf New SSSD config will be created Configured sudoers in /etc/nsswitch.conf Configured /etc/sssd/sssd.conf Configured /etc/krb5.conf for IPA realm VIKKI.IN trying https://freeipa.vikki.in/ipa/json [try 1]: Forwarding ‘schema’ to json server ‘https://freeipa.vikki.in/ipa/json' trying https://freeipa.vikki.in/ipa/session/json [try 1]: Forwarding ‘ping’ to json server ‘https://freeipa.vikki.in/ipa/session/json' [try 1]: Forwarding ‘ca_is_enabled’ to json server ‘https://freeipa.vikki.in/ipa/session/json' Systemwide CA database updated. Hostname (fedora25.vikki.in) does not have A/AAAA record. Failed to update DNS records. Missing A/AAAA record(s) for host fedora25.vikki.in: 172.17.0.1. Missing reverse record(s) for address(es): 172.17.0.1. Adding SSH public key from /etc/ssh/ssh_host_rsa_key.pub Adding SSH public key from /etc/ssh/ssh_host_ecdsa_key.pub Adding SSH public key from /etc/ssh/ssh_host_ed25519_key.pub [try 1]: Forwarding ‘host_mod’ to json server ‘https://freeipa.vikki.in/ipa/session/json' Could not update DNS SSHFP records. SSSD enabled Configured /etc/openldap/ldap.conf Configured /etc/ssh/ssh_config Configured /etc/ssh/sshd_config Configuring vikki.in as NIS domain. Client configuration complete. The ipa-client-install command was successful\n{% endhighlight %}\nOnce client is installed and authenticated to the FreeIPA server, we can verify the hosts by login to GUI as shown below\nVerify the users are synced to the client.\n{% highlight console %}\n[root@fedora25 ~]# id vivek uid=1661600001(vivek) gid=1661600001(vivek) groups=1661600001(vivek) [root@fedora25 ~]#\n{% endhighlight %}\n",
  "wordCount" : "5425",
  "inLanguage": "en",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2017-10-07T11:58:00Z",
  "dateModified": "2017-10-07T11:58:00Z",
  "author":{
    "@type": "Person",
    "name": "Vignesh Ragupathy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/2017-10-07-freeipa_installation_configuration/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Vignesh Ragupathy",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Vignesh Ragupathy (Alt + H)">Vignesh Ragupathy</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      FreeIPA Installation and configuration
    </h1>
    <div class="post-meta"><span title='2017-10-07 11:58:00 +0000 UTC'>October 7, 2017</span>&nbsp;·&nbsp;26 min&nbsp;·&nbsp;Vignesh Ragupathy&nbsp;|&nbsp;<a href="https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content/posts/2017-10-07-freeipa_installation_configuration.markdown" rel="noopener noreferrer edit" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul><ul><ul>
                <li>
                    <a href="#hostname-used" aria-label="Hostname used:">Hostname used:</a><ul>
                        <ul>
                        
                <li>
                    <a href="#freeipa-server-installation-and-configuration" aria-label="FreeIPA server Installation and Configuration">FreeIPA server Installation and Configuration</a></li></ul>
                    </ul>
                </li></ul>
                    </ul>
                    
                <li>
                    <a href="#reboot" aria-label="reboot">reboot</a></li>
                <li>
                    <a href="#yum-install--y-ipa-server-bind-bind-dyndb-ldap-ipa-server-dns" aria-label="yum install -y ipa-server bind bind-dyndb-ldap ipa-server-dns">yum install -y ipa-server bind bind-dyndb-ldap ipa-server-dns</a></li>
                <li>
                    <a href="#ipa-server-install-setup-dns" aria-label="ipa-server-install &ndash;setup-dns">ipa-server-install &ndash;setup-dns</a></li>
                <li>
                    <a href="#iptables--f" aria-label="iptables -F">iptables -F</a></li>
                <li>
                    <a href="#klist" aria-label="klist">klist</a></li>
                <li>
                    <a href="#ipa-config-mod-defaultshellbinbash" aria-label="ipa config-mod &ndash;defaultshell=/bin/bash">ipa config-mod &ndash;defaultshell=/bin/bash</a></li>
                <li>
                    <a href="#authconfig-enablemkhomedir-update" aria-label="authconfig &ndash;enablemkhomedir &ndash;update">authconfig &ndash;enablemkhomedir &ndash;update</a></li>
                <li>
                    <a href="#ipa-dnsrecord-add-vikkiin-client01-a-rec-10002" aria-label="ipa dnsrecord-add vikki.in client01 &ndash;a-rec 10.0.0.2">ipa dnsrecord-add vikki.in client01 &ndash;a-rec 10.0.0.2</a><ul>
                        <ul>
                        <ul>
                        <ul>
                        
                <li>
                    <a href="#freeipa-client-installation-and-configuration" aria-label="FreeIPA client Installation and Configuration">FreeIPA client Installation and Configuration</a></li></ul>
                    </ul>
                    </ul>
                    </ul>
                </li>
                <li>
                    <a href="#vim-etcresolvconf" aria-label="vim /etc/resolv.conf">vim /etc/resolv.conf</a></li>
                <li>
                    <a href="#yum--y-install-ipa-client" aria-label="yum -y install ipa-client">yum -y install ipa-client</a></li>
                <li>
                    <a href="#confirm-settings-and-proceed-with-yes" aria-label="confirm settings and proceed with &ldquo;yes&rdquo;">confirm settings and proceed with &ldquo;yes&rdquo;</a></li>
                <li>
                    <a href="#answer-with-admin" aria-label="answer with admin">answer with admin</a></li>
                <li>
                    <a href="#ssh" aria-label="ssh vivek@client01.vikki.in">ssh vivek@client01.vikki.in</a></li>
                <li>
                    <a href="#pwd" aria-label="pwd">pwd</a></li>
                <li>
                    <a href="#ssh-1" aria-label="ssh vivek@client01.vikki.in">ssh vivek@client01.vikki.in</a><ul>
                        <ul>
                        <ul>
                        <ul>
                        
                <li>
                    <a href="#freeipa-in-docker-container" aria-label="FreeIPA in Docker container">FreeIPA in Docker container</a></li></ul>
                    
                <li>
                    <a href="#how-to-build-freeipa-docker-container" aria-label="How to build FreeIPA docker container">How to build FreeIPA docker container</a></li></ul>
                    </ul>
                    </ul>
                </li>
                <li>
                    <a href="#package-arch-version-repository-size" aria-label="Package Arch Version Repository Size">Package Arch Version Repository Size</a></li>
                <li>
                    <a href="#transaction-summary" aria-label="Transaction Summary">Transaction Summary</a></li>
                <li>
                    <a href="#transaction-summary-1" aria-label="Transaction Summary">Transaction Summary</a><ul>
                        <ul>
                        <ul>
                        
                <li>
                    <a href="#how-to-run-the-freeipa-docker-container" aria-label="How to run the FreeIPA docker container">How to run the FreeIPA docker container</a></li></ul>
                    </ul>
                    </ul>
                </li>
                <li>
                    <a href="#the-log-file-for-this-installation-can-be-found-in-varlogipaserver-installlog" aria-label="The log file for this installation can be found in /var/log/ipaserver-install.log">The log file for this installation can be found in /var/log/ipaserver-install.log</a><ul>
                        <ul>
                        <ul>
                        
                <li>
                    <a href="#how-to-enroll-the-host-to-freeipa-running-in-container" aria-label="How to enroll the host to FreeIPA running in container">How to enroll the host to FreeIPA running in container</a>
                </li>
            </ul>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>I worked on a freelance project a year ago which gives me experience in Free IPA server. Here I am sharing some portion of the setup used.It would be useful for beginners trying to setup Free IPA server.</p>
<p>I have 2 sections here. One is about FreeIPA on the normal server and the other is FreeIPA in Docker container.</p>
<p>If you have any questions &amp; comments, feel free to add in the Disqus comment section below</p>
<p>FreeIPA stands for Free Identity, Policy, Audit. It is an open source alternative to AD that combines LDAP, Kerberos, CA services and management tools, and ships with its own schemas. It is a solution for managing users, groups, hosts, services, DNS, NTP etc.</p>
<h3 id="hostname-used">Hostname used:<a hidden class="anchor" aria-hidden="true" href="#hostname-used">#</a></h3>
<p>IPA server name: <code>freeipa.vikki.in</code><br>
IPA client name: <code>client01.vikki.in</code> (should be under the same domain e.g.: xxx.vikki.in)<br>
Docker host machine: <code>fedora25.vikki.in</code></p>
<h5 id="freeipa-server-installation-and-configuration">FreeIPA server Installation and Configuration<a hidden class="anchor" aria-hidden="true" href="#freeipa-server-installation-and-configuration">#</a></h5>
<p><em>Step 1: Set fully qualified hostname</em></p>
<p>{% highlight console %}</p>
<p>#vim /etc/hostname
freeipa.vikki.in</p>
<p>{% endhighlight %}</p>
<p><em>Step 2: Set local resolver for the hostname</em></p>
<p>{% highlight console %}</p>
<p>#vim /etc/hosts
10.0.0.1 freeipa.vikki.in freeipa</p>
<p>{% endhighlight %}</p>
<p><em>Step 3: Disable selinux(optional)</em></p>
<p>{% highlight console %}</p>
<p>#vim /etc/sysconfig/selinux
SELINUX=disabled</p>
<p>{% endhighlight %}</p>
<p><em>Step 4: Reboot server</em></p>
<p>{% highlight console %}</p>
<h1 id="reboot">reboot<a hidden class="anchor" aria-hidden="true" href="#reboot">#</a></h1>
<p>{% endhighlight %}</p>
<p><em>Step 5: Verify hostname and selinux</em></p>
<p>{% highlight console %}</p>
<p>#hostname
freeipa.vikki.in
#getenforce
Disabled</p>
<p>{% endhighlight %}</p>
<p><em>Step 6: Install ipa server</em></p>
<p>{% highlight console %}</p>
<h1 id="yum-install--y-ipa-server-bind-bind-dyndb-ldap-ipa-server-dns">yum install -y ipa-server bind bind-dyndb-ldap ipa-server-dns<a hidden class="anchor" aria-hidden="true" href="#yum-install--y-ipa-server-bind-bind-dyndb-ldap-ipa-server-dns">#</a></h1>
<p>{% endhighlight %}</p>
<p><em>Step 7: Configure FreeIPA</em></p>
<p>If you have a separate DNS server for managing the domain remove the option(&ndash;setup-dns)</p>
<p>{% highlight console %}</p>
<h1 id="ipa-server-install-setup-dns">ipa-server-install &ndash;setup-dns<a hidden class="anchor" aria-hidden="true" href="#ipa-server-install-setup-dns">#</a></h1>
<h1 id="restarting-the-web-server">Existing BIND configuration detected, overwrite? [no]: yes
Enter the fully qualified domain name of the computer
on which you&rsquo;re setting up server software. Using the form
<hostname>.<domainname>
Example: master.example.com.
Server host name [freeipa.vikki.in]: freeipa.vikki.in
Please confirm the domain name [vikki.in]: vikki.in
Please provide a realm name [VIKKI.IN]: VIKKI.IN
Directory Manager password:
Password (confirm):
IPA admin password:
Password (confirm):
Do you want to configure DNS forwarders? [yes]: yes
Enter the IP address of DNS forwarder to use, or press Enter to finish.
Enter IP address for a DNS forwarder: 8.8.8.8
DNS forwarder 8.8.8.8 added
Enter IP address for a DNS forwarder: 8.8.4.4
DNS forwarder 8.8.4.4 added
Enter IP address for a DNS forwarder: <enter>
Do you want to configure the reverse zone? [yes]: yes
Please specify the reverse zone name [0.0.10.in-addr.arpa.]: 0.0.10.in-addr.arpa
Using reverse zone 0.0.10.in-addr.arpa.
The IPA Master Server will be configured with:
Hostname: freeipa.vikki.in
IP address: 10.0.0.1
Domain name: vikki.in
Realm name: VIKKI.IN
BIND DNS server will be configured to serve IPA domain with:
Forwarders: 8.8.8.8, 8.8.4.4
Reverse zone: 0.0.10.in-addr.arpa.
Continue to configure the system with these values? [no]: yes
The following operations may take some minutes to complete.
Please wait until the prompt is returned.
Configuring NTP daemon (ntpd)
[1/4]: stopping ntpd
[2/4]: writing configuration
[3/4]: configuring ntpd to start on boot
[4/4]: starting ntpd
Done configuring NTP daemon (ntpd).
Configuring directory server (dirsrv). Estimated time: 1 minute
[1/42]: creating directory server user
[2/42]: creating directory server instance
[3/42]: adding default schema
[4/42]: enabling memberof plugin
[5/42]: enabling winsync plugin
[6/42]: configuring replication version plugin
[7/42]: enabling IPA enrollment plugin
[8/42]: enabling ldapi
[9/42]: configuring uniqueness plugin
[10/42]: configuring uuid plugin
[11/42]: configuring modrdn plugin
[12/42]: configuring DNS plugin
[13/42]: enabling entryUSN plugin
[14/42]: configuring lockout plugin
[15/42]: creating indices
[16/42]: enabling referential integrity plugin
[17/42]: configuring certmap.conf
[18/42]: configure autobind for root
[19/42]: configure new location for managed entries
[20/42]: configure dirsrv ccache
[21/42]: enable SASL mapping fallback
[22/42]: restarting directory server
[23/42]: adding default layout
[24/42]: adding delegation layout
[25/42]: creating container for managed entries
[26/42]: configuring user private groups
[27/42]: configuring netgroups from hostgroups
[28/42]: creating default Sudo bind user
[29/42]: creating default Auto Member layout
[30/42]: adding range check plugin
[31/42]: creating default HBAC rule allow_all
[32/42]: adding entries for topology management
[33/42]: initializing group membership
[34/42]: adding master entry
[35/42]: initializing domain level
[36/42]: configuring Posix uid/gid generation
[37/42]: adding replication acis
[38/42]: enabling compatibility plugin
[39/42]: activating sidgen plugin
[40/42]: activating extdom plugin
[41/42]: tuning directory server
[42/42]: configuring directory to start on boot
Done configuring directory server (dirsrv).
Configuring certificate server (pki-tomcatd). Estimated time: 3 minutes 30 seconds
[1/27]: creating certificate server user
[2/27]: configuring certificate server instance
[3/27]: stopping certificate server instance to update CS.cfg
[4/27]: backing up CS.cfg
[5/27]: disabling nonces
[6/27]: set up CRL publishing
[7/27]: enable PKIX certificate path discovery and validation
[8/27]: starting certificate server instance
[9/27]: creating RA agent certificate database
[10/27]: importing CA chain to RA certificate database
[11/27]: fixing RA database permissions
[12/27]: setting up signing cert profile
[13/27]: setting audit signing renewal to 2 years
[14/27]: restarting certificate server
[15/27]: requesting RA certificate from CA
[16/27]: issuing RA agent certificate
[17/27]: adding RA agent as a trusted user
[18/27]: authorizing RA to modify profiles
[19/27]: configure certmonger for renewals
[20/27]: configure certificate renewals
[21/27]: configure RA certificate renewal
[22/27]: configure Server-Cert certificate renewal
[23/27]: Configure HTTP to proxy connections
[24/27]: restarting certificate server
[25/27]: migrating certificate profiles to LDAP
[26/27]: importing IPA certificate profiles
[27/27]: adding default CA ACL
Done configuring certificate server (pki-tomcatd).
Configuring directory server (dirsrv). Estimated time: 10 seconds
[1/3]: configuring ssl for ds instance
[2/3]: restarting directory server
[3/3]: adding CA certificate entry
Done configuring directory server (dirsrv).
Configuring Kerberos KDC (krb5kdc). Estimated time: 30 seconds
[1/10]: adding sasl mappings to the directory
[2/10]: adding kerberos container to the directory
[3/10]: configuring KDC
[4/10]: initialize kerberos container
[5/10]: adding default ACIs
[6/10]: creating a keytab for the directory
[7/10]: creating a keytab for the machine
[8/10]: adding the password extension to the directory
[9/10]: starting the KDC
[10/10]: configuring KDC to start on boot
Done configuring Kerberos KDC (krb5kdc).
Configuring kadmin
[1/2]: starting kadmin
[2/2]: configuring kadmin to start on boot
Done configuring kadmin.
Configuring ipa_memcached
[1/2]: starting ipa_memcached
[2/2]: configuring ipa_memcached to start on boot
Done configuring ipa_memcached.
Configuring ipa-otpd
[1/2]: starting ipa-otpd
[2/2]: configuring ipa-otpd to start on boot
Done configuring ipa-otpd.
Configuring the web interface (httpd). Estimated time: 1 minute
[1/19]: setting mod_nss port to 443
[2/19]: setting mod_nss protocol list to TLSv1.0 - TLSv1.2
[3/19]: setting mod_nss password file
[4/19]: enabling mod_nss renegotiate
[5/19]: adding URL rewriting rules
[6/19]: configuring httpd
[7/19]: configure certmonger for renewals
[8/19]: setting up ssl
[9/19]: importing CA certificates from LDAP
[10/19]: setting up browser autoconfig
[11/19]: publish CA cert
[12/19]: creating a keytab for httpd
[13/19]: clean up any existing httpd ccache
[14/19]: configuring SELinux for httpd
[15/19]: create KDC proxy user
[16/19]: create KDC proxy config
[17/19]: enable KDC proxy
[18/19]: restarting httpd
[19/19]: configuring httpd to start on boot
Done configuring the web interface (httpd).
Applying LDAP updates
Upgrading IPA:
[1/9]: stopping directory server
[2/9]: saving configuration
[3/9]: disabling listeners
[4/9]: enabling DS global lock
[5/9]: starting directory server
[6/9]: upgrading server
[7/9]: stopping directory server
[8/9]: restoring configuration
[9/9]: starting directory server
Done.
Restarting the directory server
Restarting the KDC
Configuring DNS (named)
[1/12]: generating rndc key file
WARNING: Your system is running out of entropy, you may experience long delays
[2/12]: adding DNS container
[3/12]: setting up our zone
[4/12]: setting up reverse zone
[5/12]: setting up our own record
[6/12]: setting up records for other masters
[7/12]: adding NS record to the zones
[8/12]: setting up CA record
[9/12]: setting up kerberos principal
[10/12]: setting up named.conf
[11/12]: configuring named to start on boot
[12/12]: changing resolv.conf to point to ourselves
Done configuring DNS (named).
Configuring DNS key synchronization service (ipa-dnskeysyncd)
[1/7]: checking status
[2/7]: setting up bind-dyndb-ldap working directory
[3/7]: setting up kerberos principal
[4/7]: setting up SoftHSM
[5/7]: adding DNSSEC containers
[6/7]: creating replica keys
[7/7]: configuring ipa-dnskeysyncd to start on boot
Done configuring DNS key synchronization service (ipa-dnskeysyncd).
Restarting ipa-dnskeysyncd
Restarting named
Restarting the web server</h1>
<p>Setup complete
Next steps:</p>
<ol>
<li>You must make sure these network ports are open:
TCP Ports:</li>
</ol>
<ul>
<li>80, 443: HTTP/HTTPS</li>
<li>389, 636: LDAP/LDAPS</li>
<li>88, 464: kerberos</li>
<li>53: bind
UDP Ports:</li>
<li>88, 464: kerberos</li>
<li>53: bind</li>
<li>123: ntp</li>
</ul>
<ol start="2">
<li>You can now obtain a kerberos ticket using the command: &lsquo;kinit admin&rsquo;
This ticket will allow you to use the IPA tools (e.g., ipa user-add)
and the web user interface.
Be sure to back up the CA certificate stored in /root/cacert.p12
This file is required to create replicas. The password for this
file is the Directory Manager password</li>
</ol>
<p>{% endhighlight %}</p>
<p><em>Step 8: Configure firewall</em></p>
<p>{% highlight console %}</p>
<p>#firewall-cmd &ndash;permanent &ndash;add-service=ntp
#firewall-cmd &ndash;permanent &ndash;add-service=http
#firewall-cmd &ndash;permanent &ndash;add-service=https
#firewall-cmd &ndash;permanent &ndash;add-service=ldap
#firewall-cmd &ndash;permanent &ndash;add-service=ldaps
#firewall-cmd &ndash;permanent &ndash;add-service=kerberos
#firewall-cmd &ndash;permanent &ndash;add-service=kpasswd</p>
<p>{% endhighlight %}</p>
<p>Either add all the above rules in firewall or simply flush all rules from iptables(not recommended in production)</p>
<p>{% highlight console %}</p>
<h1 id="iptables--f">iptables -F<a hidden class="anchor" aria-hidden="true" href="#iptables--f">#</a></h1>
<p>{% endhighlight %}</p>
<p><em>Step 9: Get Kerberos tickets</em><br>
Now the FreeIPA server is ready , we should generate the kerberos ticket with admin privilege. This kerberos ticket is needed to run any IPA commands in server with full privileges and to connect web UI.</p>
<p>Kerberos provides authentication services for entire FreeIPA components.</p>
<p>{% highlight console %}</p>
<p>#kinit admin
Password for <a href="mailto:admin@VIKKI.IN">admin@VIKKI.IN</a>:# IPA admin password</p>
<p>{% endhighlight %}</p>
<p>We can also view the current Kerberos ticket with expiry details using the klist command. The default expiry period is 24hours.</p>
<p>{% highlight console %}</p>
<h1 id="klist">klist<a hidden class="anchor" aria-hidden="true" href="#klist">#</a></h1>
<p>Ticket cache: KEYRING:persistent:0:0
Default principal: <a href="mailto:admin@VIKKI.IN">admin@VIKKI.IN</a>
Valid starting Expires Service principal
08/09/2016 14:45:53 11/09/2016 14:45:50 <a href="mailto:krbtgt/ADMIN@VIKKI.IN">krbtgt/ADMIN@VIKKI.IN</a></p>
<p>{% endhighlight %}</p>
<p><em>step 10: Enabled home directory and default shell</em><br>
We have to enable the home directory creation and default login shell for the new user login. Run the below command to set it.</p>
<p>{% highlight console %}</p>
<h1 id="ipa-config-mod-defaultshellbinbash">ipa config-mod &ndash;defaultshell=/bin/bash<a hidden class="anchor" aria-hidden="true" href="#ipa-config-mod-defaultshellbinbash">#</a></h1>
<h1 id="authconfig-enablemkhomedir-update">authconfig &ndash;enablemkhomedir &ndash;update<a hidden class="anchor" aria-hidden="true" href="#authconfig-enablemkhomedir-update">#</a></h1>
<p>{% endhighlight %}</p>
<p><em>Step 11: Login to freeipa web</em><br>
Login to the freeIPA server from the browser and create some users.</p>
<!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="/content/images/2018/01/Screenshot-from-2018-01-19-18-40-38.png" class="kg-image" alt="Screenshot-from-2018-01-19-18-40-38"></figure><!--kg-card-end: image-->
<p><em>Step 12: Add dns entry for the IPA client</em><br>
Now the user has been created , we can configure the dns record for the new clients to be added under domain vikki.in</p>
<p>{% highlight console %}</p>
<h1 id="ipa-dnsrecord-add-vikkiin-client01-a-rec-10002">ipa dnsrecord-add vikki.in client01 &ndash;a-rec 10.0.0.2<a hidden class="anchor" aria-hidden="true" href="#ipa-dnsrecord-add-vikkiin-client01-a-rec-10002">#</a></h1>
<p>IPA Client</p>
<p>{% endhighlight %}</p>
<h5 id="freeipa-client-installation-and-configuration">FreeIPA client Installation and Configuration<a hidden class="anchor" aria-hidden="true" href="#freeipa-client-installation-and-configuration">#</a></h5>
<p><em>Step 1: Freeipa client preparation</em></p>
<p>Set hostname “client01.vikki.in”<br>
Disable “selinux”<br>
Disable “Firewall”<br>
For all the above follow the same procedure followed in FreeIPA server preparation</p>
<p><em>Step 2: Set DNS server IP to FreeIPA server</em></p>
<p>{% highlight console %}</p>
<h1 id="vim-etcresolvconf">vim /etc/resolv.conf<a hidden class="anchor" aria-hidden="true" href="#vim-etcresolvconf">#</a></h1>
<p>nameserver 10.0.0.1
#dig client01.vikki.in</p>
<p>{% endhighlight %}</p>
<p><em>Step 3: Install ipa client</em></p>
<p>{% highlight console %}</p>
<h1 id="yum--y-install-ipa-client">yum -y install ipa-client<a hidden class="anchor" aria-hidden="true" href="#yum--y-install-ipa-client">#</a></h1>
<p>Discovery was successful!
Hostname: client01.vikki.in
Realm: VIKKI.IN
DNS Domain: vikki.in
IPA Server: freeipa.vikki.in
BaseDN: dc=vikki,dc=in</p>
<h1 id="confirm-settings-and-proceed-with-yes">confirm settings and proceed with &ldquo;yes&rdquo;<a hidden class="anchor" aria-hidden="true" href="#confirm-settings-and-proceed-with-yes">#</a></h1>
<p>Continue to configure the system with these values? [no]: yes</p>
<h1 id="answer-with-admin">answer with admin<a hidden class="anchor" aria-hidden="true" href="#answer-with-admin">#</a></h1>
<p>User authorized to enroll computers: admin
Synchronizing time with KDC&hellip;
Unable to sync time with IPA NTP server, assuming the time is in sync. Please check that 123 UDP port is opened.
Password for <a href="mailto:admin@vikki.in">admin@vikki.in</a>:
Successfully retrieved CA cert
Subject: CN=Certificate Authority,O=vikki.in
Issuer: CN=Certificate Authority,O=vikki.in
Valid From: Fri Mar 20 01:42:15 2015 UTC
Valid Until: Tue Mar 20 01:42:15 2035 UTC
Enrolled in IPA realm VIKKI.IN
&hellip;..
&hellip;..
Configured /etc/ssh/ssh_config
Configured /etc/ssh/sshd_config
Client configuration complete.</p>
<p>{% endhighlight %}</p>
<p><em>Step 4: Try to login using the user created from the FreeIPA server GUI</em></p>
<p>{% highlight console %}</p>
<h1 id="ssh">ssh <a href="mailto:vivek@client01.vikki.in">vivek@client01.vikki.in</a><a hidden class="anchor" aria-hidden="true" href="#ssh">#</a></h1>
<p>Password:
Password expired. Change your password now.
Current Password:
New password:
Retype new password:
Creating home directory for vivek.
Last login: Fri Jan 19 18:44:31 2018 from localhost</p>
<h1></h1>
<p>{% endhighlight %}{% highlight console %}</p>
<h1 id="pwd">pwd<a hidden class="anchor" aria-hidden="true" href="#pwd">#</a></h1>
<p>/home/vivek</p>
<p>{% endhighlight %}</p>
<p>If you have not enabled the home directory creation and login shell , you will get the below output.</p>
<p>{% highlight console %}</p>
<h1 id="ssh-1">ssh <a href="mailto:vivek@client01.vikki.in">vivek@client01.vikki.in</a><a hidden class="anchor" aria-hidden="true" href="#ssh-1">#</a></h1>
<p>Password:
Password expired. Change your password now.
Current Password:
New password:
Retype new password:
Could not chdir to home directory /home/vivek: No such file or directory
-sh-4.2$</p>
<p>{% endhighlight %}</p>
<h5 id="freeipa-in-docker-container">FreeIPA in Docker container<a hidden class="anchor" aria-hidden="true" href="#freeipa-in-docker-container">#</a></h5>
<p>FreeIPA is also available as a docker container. We can download the FreeIPA repository from github <a href="https://github.com/freeipa/freeipa-container/archive/master.zip">master.zip</a>.</p>
<h4 id="how-to-build-freeipa-docker-container">How to build FreeIPA docker container<a hidden class="anchor" aria-hidden="true" href="#how-to-build-freeipa-docker-container">#</a></h4>
<p>Download the zip file, extract it , go inside the directory and run the docker build.</p>
<p>This repository has &ldquo;Dockerfile&rdquo; which supports many operation system, use the one you required. Here i am installing the container in Fedora27 , so i passing the respective dockerfile using &ldquo;-f&rdquo; option.</p>
<p>{% highlight console %}</p>
<h1 id="dependencies-resolved">[root@fedora25 freeipa-container-master]# docker build -t freeipa-server -f Dockerfile.fedora-27 .
Sending build context to Docker daemon 161.3 kB
Step 1/45 : FROM registry.fedoraproject.org/fedora:27
Trying to pull repository registry.fedoraproject.org/fedora &hellip;
sha256:44be9569d32fee1846afd1d17dc681c2b8f1f2b367764194ade32d9bfdf1984f: Pulling from registry.fedoraproject.org/fedora
178a618c1fcb: Pull complete
Digest: sha256:44be9569d32fee1846afd1d17dc681c2b8f1f2b367764194ade32d9bfdf1984f
Status: Downloaded newer image for registry.fedoraproject.org/fedora:27
&mdash;&gt; 9881e4229c95
Step 2/45 : MAINTAINER Jan Pazdziora
&mdash;&gt; Running in 4ccc52e61959
&mdash;&gt; e6203b4f193f
Removing intermediate container 4ccc52e61959
Step 3/45 : RUN groupadd -g 288 kdcproxy ; useradd -u 288 -g 288 -c &lsquo;IPA KDC Proxy User&rsquo; -d &lsquo;/var/lib/kdcproxy&rsquo; -s &lsquo;/sbin/nologin&rsquo; kdcproxy
&mdash;&gt; Running in 281bede2e1ca
&mdash;&gt; 11f29258686a
Removing intermediate container 281bede2e1ca
Step 4/45 : RUN groupadd -g 289 ipaapi; useradd -u 289 -g 289 -c &lsquo;IPA Framework User&rsquo; -d / -s &lsquo;/sbin/nologin&rsquo; ipaapi
&mdash;&gt; Running in acff04c732af
useradd: warning: the home directory already exists.
Not copying any file from skel directory into it.
&mdash;&gt; 9100a9565039
Removing intermediate container acff04c732af
Step 5/45 : RUN mkdir -p /run/lock &amp;&amp; dnf upgrade -y &amp;&amp; dnf install -y freeipa-server freeipa-server-dns freeipa-server-trust-ad initscripts &amp;&amp; dnf clean all
&mdash;&gt; Running in b33a6dd071aa
Fedora 27 - x86_64 - Updates 3.2 MB/s | 16 MB 00:05 <br>
Fedora 27 - x86_64 3.0 MB/s | 58 MB 00:19 <br>
Last metadata expiration check: 0:00:06 ago on Sat Jan 20 06:40:05 2018.
Dependencies resolved.</h1>
<h1 id="package-arch-version-repository-size">Package Arch Version Repository Size<a hidden class="anchor" aria-hidden="true" href="#package-arch-version-repository-size">#</a></h1>
<p>Upgrading:
gdbm x86_64 1:1.13-6.fc27 updates 158 k</p>
<h1 id="transaction-summary">Transaction Summary<a hidden class="anchor" aria-hidden="true" href="#transaction-summary">#</a></h1>
<p>Upgrade 1 Package</p>
<h2 id="gdbm-113-6fc27x86_64rpm-198-kbs--158-kb-0000">Total download size: 158 k
Downloading Packages:
gdbm-1.13-6.fc27.x86_64.rpm 198 kB/s | 158 kB 00:00</h2>
<p>Total 72 kB/s | 158 kB 00:02  <br>
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
Preparing : 1/1
Upgrading : gdbm-1:1.13-6.fc27.x86_64 1/2
Running scriptlet: gdbm-1:1.13-6.fc27.x86_64 1/2
Cleanup : gdbm-1.14-1.fc27.x86_64 2/2
Running scriptlet: gdbm-1.14-1.fc27.x86_64 2/2
Verifying : gdbm-1:1.13-6.fc27.x86_64 1/2
Verifying : gdbm-1.14-1.fc27.x86_64 2/2</p>
<p>Upgraded:
gdbm.x86_64 1:1.13-6.fc27</p>
<h1 id="dependencies-resolved-1">Complete!
Last metadata expiration check: 0:00:38 ago on Sat Jan 20 06:40:05 2018.
Dependencies resolved.</h1>
<h1 id="size">Package Arch Version Repository
Size</h1>
<p>Installing:
freeipa-server x86_64 4.6.1-3.fc27 fedora 398 k
freeipa-server-dns noarch 4.6.1-3.fc27 fedora 60 k
freeipa-server-trust-ad x86_64 4.6.1-3.fc27 fedora 152 k
initscripts x86_64 9.79-1.fc27 updates 394 k
Installing dependencies:
389-ds-base x86_64 1.3.7.8-1.fc27 updates 1.8 M
389-ds-base-libs x86_64 1.3.7.8-1.fc27 updates 744 k
GeoIP x86_64 1.6.11-3.fc27 fedora 124 k
GeoIP-GeoLite-data noarch 2018.01-1.fc27 updates 465 k
timedatex x86_64 0.4-5.fc27 fedora 30 k</p>
<h1 id="transaction-summary-1">Transaction Summary<a hidden class="anchor" aria-hidden="true" href="#transaction-summary-1">#</a></h1>
<p>Install 416 Packages</p>
<h2 id="416416-libicu-571-9fc27x86_64rpm-862-kbs--84-mb-0009">Total download size: 184 M
Installed size: 568 M
Downloading Packages:
(1/416): freeipa-server-dns-4.6.1-3.fc27.noarch 103 kB/s | 60 kB 00:00 <br>
(2/416): freeipa-server-trust-ad-4.6.1-3.fc27.x 208 kB/s | 152 kB 00:00 <br>
(3/416): cyrus-sasl-gssapi-2.1.26-34.fc27.x86_6 286 kB/s | 46 kB 00:00 <br>
(4/416): freeipa-server-4.6.1-3.fc27.x86_64.rpm 365 kB/s | 398 kB 00:01 <br>
(5/416): freeipa-client-4.6.1-3.fc27.x86_64.rpm 441 kB/s | 159 kB 00:00 <br>
(415/416): linux-atm-libs-2.5.1-19.fc27.x86_64. 154 kB/s | 40 kB 00:00 <br>
(416/416): libicu-57.1-9.fc27.x86_64.rpm 862 kB/s | 8.4 MB 00:09</h2>
<p>Total 2.0 MB/s | 184 MB 01:30  <br>
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
Running scriptlet: copy-jdk-configs-3.3-2.fc27.noarch 1/1
Running scriptlet: pki-base-10.5.1-1.fc27.noarch 1/1
Running scriptlet: java-1.8.0-openjdk-headless-1:1.8.0.151-1.b12.fc27.x 1/1
Preparing : 1/1
Installing : perl-Exporter-5.72-395.fc27.noarch 1/416
Installing : perl-libs-4:5.26.1-402.fc27.x86_64 2/416
Running scriptlet: perl-libs-4:5.26.1-402.fc27.x86_64                <br>
Installing : freetype-2.8-7.fc27.x86_64 215/416
Running scriptlet: opendnssec-1.4.14-1.fc27.x86_64 216/416
Installing : opendnssec-1.4.14-1.fc27.x86_64 216/416
Running scriptlet: opendnssec-1.4.14-1.fc27.x86_64 216/416
The token has been initialized and is reassigned to slot 1739892472
INFO: The XML in /etc/opendnssec/conf.xml is valid
INFO: The XML in /etc/opendnssec/zonelist.xml is valid
INFO: The XML in /etc/opendnssec/kasp.xml is valid
WARNING: In policy default, Y used in duration field for Keys/KSK Lifetime (P1Y) in /etc/opendnssec/kasp.xml - this will be interpreted as 365 days
WARNING: In policy lab, Y used in duration field for Keys/KSK Lifetime (P1Y) in /etc/opendnssec/kasp.xml - this will be interpreted as 365 days
<em>WARNING</em> This will erase all data in the database; are you sure? [y/N] fixing permissions on file /var/opendnssec/kasp.db
zonelist filename set to /etc/opendnssec/zonelist.xml.
kasp filename set to /etc/opendnssec/kasp.xml.
Repository SoftHSM found
No Maximum Capacity set.
RequireBackup NOT set; please make sure that you know the potential problems of using keys which are not recoverable
Policy default found
Info: converting P1Y to seconds; M interpreted as 31 days, Y interpreted as 365 days
Policy lab found
Info: converting P1Y to seconds; M interpreted as 31 days, Y interpreted as 365 days
Installing : net-tools-2.0-0.45.20160912git.fc27.x86_64 416/416
Running scriptlet: libsss_sudo-1.16.0-5.fc27.x86_64 416/416Failed to connect to bus: No such file or directory</p>
<p>Verifying : freeipa-server-4.6.1-3.fc27.x86_64 1/416
Verifying : freeipa-server-dns-4.6.1-3.fc27.noarch 2/416
Verifying : freeipa-server-trust-ad-4.6.1-3.fc27.x86_64 3/416
Verifying : cyrus-sasl-gssapi-2.1.26-34.fc27.x86_64           <br>
Verifying : lua-posix-33.3.1-7.fc27.x86_64 415/416
Verifying : perl-libnet-3.11-1.fc27.noarch 416/416</p>
<p>Installed:
freeipa-server.x86_64 4.6.1-3.fc27                                         <br>
freeipa-server-dns.noarch 4.6.1-3.fc27                                     <br>
freeipa-server-trust-ad.x86_64 4.6.1-3.fc27</p>
<p>xsom.noarch 0-17.20110809svn.fc27</p>
<p>Complete!
Non-fatal <unknown> scriptlet failure in rpm package nfs-utils
Non-fatal <unknown> scriptlet failure in rpm package nfs-utils
Non-fatal <unknown> scriptlet failure in rpm package nfs-utils
Non-fatal <unknown> scriptlet failure in rpm package nfs-utils
Non-fatal POSTIN scriptlet failure in rpm package freeipa-server-trust-ad
Non-fatal POSTIN scriptlet failure in rpm package freeipa-server-trust-ad
18 files removed
&mdash;&gt; 8e5982e4aba2
Removing intermediate container b33a6dd071aa
Step 6/45 : RUN sed -i &lsquo;/installutils.verify_fqdn(config.master_host_name, options.no_host_dns)/s/)/, local_hostname=False)/&rsquo; /usr/lib/python2.7/site-packages/ipaserver/install/server/replicainstall.py &amp;&amp; python -m compileall /usr/lib/python2.7/site-packages/ipaserver/install/server/replicainstall.py
&mdash;&gt; Running in 3f16baa3e82f
Compiling /usr/lib/python2.7/site-packages/ipaserver/install/server/replicainstall.py &hellip;
&mdash;&gt; 907bee58561a
Removing intermediate container 3f16baa3e82f
Step 7/45 : RUN sed -i &lsquo;/installutils.verify_fqdn(config.master_host_name, options.no_host_dns)/s/)/, local_hostname=False)/&rsquo; /usr/lib/python3.6/site-packages/ipaserver/install/server/replicainstall.py &amp;&amp; python3 -m compileall /usr/lib/python3.6/site-packages/ipaserver/install/server/replicainstall.py
&mdash;&gt; Running in c33cb158b26c
Compiling &lsquo;/usr/lib/python3.6/site-packages/ipaserver/install/server/replicainstall.py&rsquo;&hellip;
&mdash;&gt; 0a6e9da4fd27
Removing intermediate container c33cb158b26c
Step 8/45 : RUN [-L /etc/systemd/system/syslog.service] &amp;&amp; ! [-f /etc/systemd/system/syslog.service] &amp;&amp; rm -f /etc/systemd/system/syslog.service
&mdash;&gt; Running in d7ef9f4d9b2a
&mdash;&gt; 9980910fa2dc
Removing intermediate container d7ef9f4d9b2a
Step 9/45 : RUN find /etc/systemd/system/* &lsquo;!&rsquo; -name &lsquo;<em>.wants&rsquo; | xargs rm -rvf
&mdash;&gt; Running in 594660eda1bc
removed &lsquo;/etc/systemd/system/basic.target.wants/dnf-makecache.timer&rsquo;
removed &lsquo;/etc/systemd/system/console-getty.service&rsquo;
removed &lsquo;/etc/systemd/system/dbus-org.freedesktop.timedate1.service&rsquo;
removed &lsquo;/etc/systemd/system/default.target&rsquo;
removed &lsquo;/etc/systemd/system/dev-hugepages.mount&rsquo;
removed &lsquo;/etc/systemd/system/getty.target&rsquo;
removed &lsquo;/etc/systemd/system/getty.target.wants/getty@tty1.service&rsquo;
removed directory &lsquo;/etc/systemd/system/httpd.d&rsquo;
removed &lsquo;/etc/systemd/system/local-fs.target.wants/fedora-readonly.service&rsquo;
removed &lsquo;/etc/systemd/system/multi-user.target.wants/remote-fs.target&rsquo;
removed &lsquo;/etc/systemd/system/multi-user.target.wants/auditd.service&rsquo;
removed &lsquo;/etc/systemd/system/multi-user.target.wants/nfs-client.target&rsquo;
removed &lsquo;/etc/systemd/system/multi-user.target.wants/sssd.service&rsquo;
removed &lsquo;/etc/systemd/system/remote-fs.target.wants/nfs-client.target&rsquo;
removed &lsquo;/etc/systemd/system/sockets.target.wants/sssd-secrets.socket&rsquo;
removed &lsquo;/etc/systemd/system/sys-fs-fuse-connections.mount&rsquo;
removed &lsquo;/etc/systemd/system/sysinit.target.wants/fedora-import-state.service&rsquo;
removed &lsquo;/etc/systemd/system/systemd-logind.service&rsquo;
removed &lsquo;/etc/systemd/system/systemd-remount-fs.service&rsquo;
removed &lsquo;/etc/systemd/system/systemd-timedated.service&rsquo;
&mdash;&gt; 6273c3ce8454
Removing intermediate container 594660eda1bc
Step 10/45 : RUN for i in basic.target network.service netconsole.service ; do rm -f /usr/lib/systemd/system/$i &amp;&amp; ln -s /dev/null /usr/lib/systemd/system/$i ; done
&mdash;&gt; Running in 3805f0460b62
&mdash;&gt; a82df26e2086
Removing intermediate container 3805f0460b62
Step 11/45 : RUN rm -fv /usr/lib/systemd/system/sysinit.target.wants/</em>
&mdash;&gt; Running in 2340c6e904de
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/cryptsetup.target&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/dev-hugepages.mount&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/dev-mqueue.mount&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/ldconfig.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/proc-sys-fs-binfmt_misc.automount&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/sys-fs-fuse-connections.mount&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/sys-kernel-config.mount&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/sys-kernel-debug.mount&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-ask-password-console.path&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-binfmt.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-firstboot.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-journal-catalog-update.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-journal-flush.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-journald.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-machine-id-commit.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-sysctl.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-sysusers.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-tmpfiles-setup.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-update-done.service&rsquo;
removed &lsquo;/usr/lib/systemd/system/sysinit.target.wants/systemd-update-utmp.service&rsquo;
&mdash;&gt; e575744cbec4
Removing intermediate container 2340c6e904de
Step 12/45 : RUN echo &lsquo;disable <em>&rsquo; &gt; /usr/lib/systemd/system-preset/10-container-disable.preset
&mdash;&gt; Running in c2c372a783c6
&mdash;&gt; afbb3fa9de01
Removing intermediate container c2c372a783c6
Step 13/45 : RUN /sbin/ldconfig -X
&mdash;&gt; Running in d4e981ba0dae
&mdash;&gt; 18cde0edd362
Removing intermediate container d4e981ba0dae
Step 14/45 : COPY init-data /usr/local/sbin/init
&mdash;&gt; e3cf2eac153f
Removing intermediate container b5a7b4f89ee8
Step 15/45 : COPY ipa-server-configure-first ipa-server-status-check exit-with-status ipa-volume-upgrade-</em> /usr/sbin/
&mdash;&gt; c60a71108eda
Removing intermediate container b38588e0eecc
Step 16/45 : COPY install.sh uninstall.sh /bin/
&mdash;&gt; d208c2ad0dea
Removing intermediate container 633df7d21612
Step 17/45 : RUN mv /bin/hostnamectl /bin/hostnamectl.orig
&mdash;&gt; Running in d84b0e146325
&mdash;&gt; 41a46d7a76d0
Removing intermediate container d84b0e146325
Step 18/45 : RUN mv /usr/bin/domainname /usr/bin/domainname.orig
&mdash;&gt; Running in 808c9796831e
&mdash;&gt; bdd853c871b6
Removing intermediate container 808c9796831e
Step 19/45 : ADD hostnamectl-wrapper /bin/hostnamectl
&mdash;&gt; f34600ec54fd
Removing intermediate container f6f3c216ffd4
Step 20/45 : ADD hostnamectl-wrapper /usr/bin/domainname
&mdash;&gt; 49fb7d34f8af
Removing intermediate container 3c3c1695eb37
Step 21/45 : RUN chmod -v +x /usr/local/sbin/init /usr/sbin/ipa-server-configure-first /usr/sbin/ipa-server-status-check /usr/sbin/exit-with-status /usr/sbin/ipa-volume-upgrade-* /bin/install.sh /bin/uninstall.sh /bin/hostnamectl /usr/bin/domainname
&mdash;&gt; Running in c322618dc805
mode of &lsquo;/usr/local/sbin/init&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/sbin/ipa-server-configure-first&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/sbin/ipa-server-status-check&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/sbin/exit-with-status&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/sbin/ipa-volume-upgrade-0.5-0.6&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/sbin/ipa-volume-upgrade-0.5-1.0&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/sbin/ipa-volume-upgrade-0.5-1.1&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/sbin/ipa-volume-upgrade-0.6-1.0&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/sbin/ipa-volume-upgrade-0.6-1.1&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/sbin/ipa-volume-upgrade-1.0-1.1&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/bin/install.sh&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/bin/uninstall.sh&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/bin/hostnamectl&rsquo; retained as 0755 (rwxr-xr-x)
mode of &lsquo;/usr/bin/domainname&rsquo; retained as 0755 (rwxr-xr-x)
&mdash;&gt; 0395279a17e5
Removing intermediate container c322618dc805
Step 22/45 : COPY container-ipa.target ipa-server-configure-first.service ipa-server-upgrade.service ipa-server-update-self-ip-address.service /usr/lib/systemd/system/
&mdash;&gt; b9a4d37d8af7
Removing intermediate container 8218605ec53b
Step 23/45 : RUN rmdir -v /etc/systemd/system/multi-user.target.wants &amp;&amp; mkdir /etc/systemd/system/container-ipa.target.wants &amp;&amp; ln -s /etc/systemd/system/container-ipa.target.wants /etc/systemd/system/multi-user.target.wants
&mdash;&gt; Running in d5554f6b4498
rmdir: removing directory, &lsquo;/etc/systemd/system/multi-user.target.wants&rsquo;
&mdash;&gt; ca9aaf468af8
Removing intermediate container d5554f6b4498
Step 24/45 : RUN systemctl set-default container-ipa.target
&mdash;&gt; Running in 2b40be183177
Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/container-ipa.target.
&mdash;&gt; 3d9f7251ef3d
Removing intermediate container 2b40be183177
Step 25/45 : RUN systemctl enable ipa-server-configure-first.service
&mdash;&gt; Running in 6a7badce6e3e
Created symlink /etc/systemd/system/container-ipa.target.wants/ipa-server-configure-first.service → /usr/lib/systemd/system/ipa-server-configure-first.service.
&mdash;&gt; 74059555138d
Removing intermediate container 6a7badce6e3e
Step 26/45 : COPY exit-via-chroot.conf /usr/lib/systemd/system/systemd-poweroff.service.d/
&mdash;&gt; 6f481582dd11
Removing intermediate container d704db80e37d
Step 27/45 : COPY atomic-install-help /usr/share/ipa/
&mdash;&gt; 7f31c6a39572
Removing intermediate container 19f606e9e0bc
Step 28/45 : COPY volume-data-list volume-data-mv-list volume-data-autoupdate /etc/
&mdash;&gt; b9c4aa387aa4
Removing intermediate container ca6ce5b07075
Step 29/45 : RUN set -e ; cd / ; mkdir /data-template ; cat /etc/volume-data-list | while read i ; do echo $i ; if [-e $i] ; then tar cf - .$i | ( cd /data-template &amp;&amp; tar xf - ) ; else mkdir -p /data-template$( dirname $i ) ; fi ; mkdir -p $( dirname $i ) ; if [&quot;$i&quot; == /var/log/] ; then mv /var/log /var/log-removed ; else rm -rf $i ; fi ; ln -sf /data${i%/} ${i%/} ; done
&mdash;&gt; Running in 1e849a37ee72
/etc/certmonger/
/etc/dirsrv/
&hellip;..
/var/named/data/
/var/named/dynamic/
/var/named/dyndb-ldap/
&mdash;&gt; 49bf3153d005
Removing intermediate container 1e849a37ee72
Step 30/45 : RUN rm -rf /var/log-removed
&mdash;&gt; Running in 35d0bb1e34ac
&mdash;&gt; 6d13c89ca7b8
Removing intermediate container 35d0bb1e34ac
Step 31/45 : RUN sed -i &rsquo;s!^d /var/log.*!L /var/log - - - - /data/var/log!&rsquo; /usr/lib/tmpfiles.d/var.conf
&mdash;&gt; Running in 3287ce189368
&mdash;&gt; 0fc4ec2c345c
Removing intermediate container 3287ce189368
Step 32/45 : RUN mv /usr/lib/tmpfiles.d/journal-nocow.conf /usr/lib/tmpfiles.d/journal-nocow.conf.disabled
&mdash;&gt; Running in 07849f109455
&mdash;&gt; d80610223617
Removing intermediate container 07849f109455
Step 33/45 : RUN rm -f /data-template/var/lib/systemd/random-seed
&mdash;&gt; Running in b009e068aa00
&mdash;&gt; 3aa621b575ae
Removing intermediate container b009e068aa00
Step 34/45 : RUN echo 1.1 &gt; /etc/volume-version
&mdash;&gt; Running in a9e66d69544f
&mdash;&gt; 05d2ab591923
Removing intermediate container a9e66d69544f
Step 35/45 : ENV container docker
&mdash;&gt; Running in 27b114bb9901
&mdash;&gt; 3b927b73f0db
Removing intermediate container 27b114bb9901
Step 36/45 : EXPOSE 53/udp 53 80 443 389 636 88 464 88/udp 464/udp 123/udp 7389 9443 9444 9445
&mdash;&gt; Running in da76877790e9
&mdash;&gt; 40e09ab03c05
Removing intermediate container da76877790e9
Step 37/45 : VOLUME /tmp /run /data /var/log/journal
&mdash;&gt; Running in 0ea0157b1149
&mdash;&gt; 81126c6e8057
Removing intermediate container 0ea0157b1149
Step 38/45 : STOPSIGNAL RTMIN+3
&mdash;&gt; Running in 0829533a8567
&mdash;&gt; 0d9947067ebe
Removing intermediate container 0829533a8567
Step 39/45 : ENTRYPOINT /usr/local/sbin/init
&mdash;&gt; Running in 3f6c0821043f
&mdash;&gt; 31def441bb06
Removing intermediate container 3f6c0821043f
Step 40/45 : RUN uuidgen &gt; /data-template/build-id
&mdash;&gt; Running in 70183a84ee14
&mdash;&gt; dbb914132b5f
Removing intermediate container 70183a84ee14
Step 41/45 : LABEL install &lsquo;docker run -ti &ndash;rm &ndash;privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} -e NAME=${NAME} -e IMAGE=${IMAGE} ${IMAGE} /bin/install.sh&rsquo;
&mdash;&gt; Running in 6deca08f490d
&mdash;&gt; 5fed892b4df7
Removing intermediate container 6deca08f490d
Step 42/45 : LABEL run &lsquo;docker run ${RUN_OPTS} &ndash;name ${NAME} -v /var/lib/${NAME}:/data:Z -v /sys/fs/cgroup:/sys/fs/cgroup:ro &ndash;tmpfs /run &ndash;tmpfs /tmp -v /dev/urandom:/dev/random:ro ${IMAGE}&rsquo;
&mdash;&gt; Running in 7c26df7faabc
&mdash;&gt; 686f0db1737b
Removing intermediate container 7c26df7faabc
Step 43/45 : LABEL RUN_OPTS_FILE &lsquo;/var/lib/${NAME}/docker-run-opts&rsquo;
&mdash;&gt; Running in 7ecd298291f9
&mdash;&gt; 6070645145b8
Removing intermediate container 7ecd298291f9
Step 44/45 : LABEL stop &lsquo;docker stop ${NAME}&rsquo;
&mdash;&gt; Running in 7303fefc3b5c
&mdash;&gt; b43a46e901d8
Removing intermediate container 7303fefc3b5c
Step 45/45 : LABEL uninstall &lsquo;docker run &ndash;rm &ndash;privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} ${IMAGE} /bin/uninstall.sh&rsquo;
&mdash;&gt; Running in bf4fb0f57293
&mdash;&gt; e17fec1f8cf2
Removing intermediate container bf4fb0f57293
Successfully built e17fec1f8cf2</p>
<p>{% endhighlight %}</p>
<p>Once the repository is build, we can verify the images in docker.The docker image we created is <code>freeipa-server</code> showing below</p>
<p>{% highlight console %}</p>
<p>[root@fedora25 freeipa-container-master]# docker images
REPOSITORY TAG IMAGE ID CREATED SIZE
freeipa-server latest e17fec1f8cf2 10 minutes ago 855 MB
registry.fedoraproject.org/fedora 27 9881e4229c95 47 hours ago 252 MB
docker.io/freeipa/freeipa-server latest c1ab4ccd4cbc 7 days ago 795 MB</p>
<p>{% endhighlight %}</p>
<h4 id="how-to-run-the-freeipa-docker-container">How to run the FreeIPA docker container<a hidden class="anchor" aria-hidden="true" href="#how-to-run-the-freeipa-docker-container">#</a></h4>
<p>Now before running the container. Create a directory(used as a volume in docker instance) and set the necessary permission</p>
<p>{% highlight console %}</p>
<p>[root@fedora25 freeipa-container-master]# mkdir /var/lib/ipa-data</p>
<p>{% endhighlight %}{% highlight console %}</p>
<p>[root@fedora25 freeipa-container-master]# setsebool -P container_manage_cgroup 1
[root@fedora25 freeipa-container-master]# chmod 777 /var/lib/ipa-data</p>
<p>{% endhighlight %}</p>
<p>If you need to access the docker container outside the host, you should map the container ports with host ports using option -p 53:53/udp -p 53:53 -p 80:80 -p 443:443 -p 389:389 -p 636:636 -p 88:88 -p 464:464 -p 88:88/udp -p 464:464/udp -p 123:123/udp -p 7389:7389 -p 9443:9443 -p 9444:9444 -p 9445:9445. But here of for testing i am doing the default install</p>
<p>Now start run the docker</p>
<p>{% highlight console %}</p>
<p>[root@fedora25 freeipa-container-master]# docker run &ndash;name freeipa-server-container -ti -h freeipa.vikki.in -v /sys/fs/cgroup:/sys/fs/cgroup:ro &ndash;tmpfs /run &ndash;tmpfs /tmp -v /var/lib/ipa-data:/data:Z freeipa-server
systemd 234 running in system mode. (+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD -IDN2 +IDN default-hierarchy=hybrid)
Detected virtualization docker.
Detected architecture x86-64.
Set hostname to &lt;freeipa.vikki.in&gt;.
Initializing machine ID from random generator.
system.slice: Failed to set invocation ID on control group /system.slice/docker-30667326bf93d1776a13acc7f395167f87aeb44326f4785e51c851bf35a1f46f.scope/system.slice, ignoring: Operation not permitted
systemd-journald.service: Failed to set invocation ID on control group /system.slice/docker-30667326bf93d1776a13acc7f395167f87aeb44326f4785e51c851bf35a1f46f.scope/system.slice/systemd-journald.service, ignoring: Operation not permitted
systemd-tmpfiles-setup.service: Failed to set invocation ID on control group /system.slice/docker-30667326bf93d1776a13acc7f395167f87aeb44326f4785e51c851bf35a1f46f.scope/system.slice/systemd-tmpfiles-setup.service, ignoring: Operation not permitted
Sat Jan 20 07:09:58 UTC 2018 /usr/sbin/ipa-server-configure-first</p>
<h1 id="the-log-file-for-this-installation-can-be-found-in-varlogipaserver-installlog">The log file for this installation can be found in /var/log/ipaserver-install.log<a hidden class="anchor" aria-hidden="true" href="#the-log-file-for-this-installation-can-be-found-in-varlogipaserver-installlog">#</a></h1>
<p>This program will set up the FreeIPA Server.</p>
<p>This includes:</p>
<ul>
<li>Configure a stand-alone CA (dogtag) for certificate management</li>
<li>Configure the Network Time Daemon (ntpd)</li>
<li>Create and configure an instance of Directory Server</li>
<li>Create and configure a Kerberos Key Distribution Center (KDC)</li>
<li>Configure Apache (httpd)</li>
<li>Configure the KDC to enable PKINIT</li>
</ul>
<p>To accept the default shown in brackets, press the Enter key.</p>
<p>Do you want to configure integrated DNS (BIND)? [no]:</p>
<p>Enter the fully qualified domain name of the computer
on which you&rsquo;re setting up server software. Using the form
<hostname>.<domainname>
Example: master.example.com.</p>
<p>Server host name [freeipa.vikki.in]:</p>
<p>The domain name has been determined based on the host name.</p>
<p>Please confirm the domain name [vikki.in]:</p>
<p>The kerberos protocol requires a Realm name to be defined.
This is typically the domain name converted to uppercase.</p>
<p>Please provide a realm name [VIKKI.IN]:
Certain directory server operations require an administrative user.
This user is referred to as the Directory Manager and has full access
to the Directory for system management tasks and will be added to the
instance of directory server created for IPA.
The password must be at least 8 characters long.</p>
<p>Directory Manager password:
Password (confirm):</p>
<p>The IPA server requires an administrative user, named &lsquo;admin&rsquo;.
This user is a regular system account used for IPA server administration.</p>
<p>IPA admin password:
Password (confirm):</p>
<p>The IPA Master Server will be configured with:
Hostname: freeipa.vikki.in
IP address(es): 172.17.0.2
Domain name: vikki.in
Realm name: VIKKI.IN</p>
<p>Continue to configure the system with these values? [no]: yes</p>
<p>The following operations may take some minutes to complete.
Please wait until the prompt is returned.</p>
<p>Configuring NTP daemon (ntpd)
[1/4]: stopping ntpd
[2/4]: writing configuration
[3/4]: configuring ntpd to start on boot
[4/4]: starting ntpd
Done configuring NTP daemon (ntpd).
Configuring directory server (dirsrv). Estimated time: 30 seconds
[1/45]: creating directory server instance
[2/45]: enabling ldapi
[3/45]: configure autobind for root
&hellip;.<br>
[45/45]: configuring directory to start on boot
Done configuring directory server (dirsrv).
Configuring Kerberos KDC (krb5kdc)
[1/10]: adding kerberos container to the directory
[2/10]: configuring KDC
[3/10]: initialize kerberos container
&hellip;.
[28/29]: adding &lsquo;ipa&rsquo; CA entry
[29/29]: configuring certmonger renewal for lightweight CAs
Done configuring certificate server (pki-tomcatd).
Configuring directory server (dirsrv)
[1/3]: configuring TLS for DS instance
[2/3]: adding CA certificate entry
[3/3]: restarting directory server
Done configuring directory server (dirsrv).
Configuring ipa-otpd
[1/2]: starting ipa-otpd
[2/2]: configuring ipa-otpd to start on boot
Done configuring ipa-otpd.
Configuring ipa-custodia
[1/5]: Generating ipa-custodia config file
[2/5]: Making sure custodia container exists
[3/5]: Generating ipa-custodia keys
[4/5]: starting ipa-custodia
[5/5]: configuring ipa-custodia to start on boot
Done configuring ipa-custodia.
Configuring the web interface (httpd)
[1/22]: stopping httpd
[2/22]: setting mod_nss port to 443
&hellip;.
[22/22]: enabling oddjobd
Done configuring the web interface (httpd).
Configuring Kerberos KDC (krb5kdc)
[1/1]: installing X509 Certificate for PKINIT
Done configuring Kerberos KDC (krb5kdc).
Applying LDAP updates
Upgrading IPA:. Estimated time: 1 minute 30 seconds
[1/9]: stopping directory server
&hellip;..
[9/9]: starting directory server
Done.
Restarting the KDC
ipaserver.dns_data_management: ERROR unable to resolve host name freeipa.vikki.in. to IP address, ipa-ca DNS record will be incomplete
Please add records in this file to your DNS system: /tmp/ipa.system.records.dc9aakkj.db
Configuring client side components
Using existing certificate &lsquo;/etc/ipa/ca.crt&rsquo;.
Client hostname: freeipa.vikki.in
Realm: VIKKI.IN
DNS Domain: vikki.in
IPA Server: freeipa.vikki.in
BaseDN: dc=vikki,dc=in</p>
<p>Skipping synchronizing time with NTP server.
New SSSD config will be created
Configured sudoers in /etc/nsswitch.conf
Configured /etc/sssd/sssd.conf
trying <a href="https://freeipa.vikki.in/ipa/json">https://freeipa.vikki.in/ipa/json</a>
[try 1]: Forwarding &lsquo;schema&rsquo; to json server &lsquo;<a href="https://freeipa.vikki.in/ipa/json%27">https://freeipa.vikki.in/ipa/json'</a>
trying <a href="https://freeipa.vikki.in/ipa/session/json">https://freeipa.vikki.in/ipa/session/json</a>
[try 1]: Forwarding &lsquo;ping&rsquo; to json server &lsquo;<a href="https://freeipa.vikki.in/ipa/session/json%27">https://freeipa.vikki.in/ipa/session/json'</a>
[try 1]: Forwarding &lsquo;ca_is_enabled&rsquo; to json server &lsquo;<a href="https://freeipa.vikki.in/ipa/session/json%27">https://freeipa.vikki.in/ipa/session/json'</a>
Systemwide CA database updated.
SSSD enabled
Configured /etc/openldap/ldap.conf
/etc/ssh/ssh_config not found, skipping configuration
/etc/ssh/sshd_config not found, skipping configuration
Configuring vikki.in as NIS domain.
Client configuration complete.
The ipa-client-install command was successful</p>
<p>==============================================================================
Setup complete</p>
<p>Next steps:</p>
<ol>
<li>
<p>You must make sure these network ports are open:
TCP Ports:</p>
<ul>
<li>80, 443: HTTP/HTTPS</li>
<li>389, 636: LDAP/LDAPS</li>
<li>88, 464: kerberos
UDP Ports:</li>
<li>88, 464: kerberos</li>
<li>123: ntp</li>
</ul>
</li>
<li>
<p>You can now obtain a kerberos ticket using the command: &lsquo;kinit admin&rsquo;
This ticket will allow you to use the IPA tools (e.g., ipa user-add)
and the web user interface.</p>
</li>
<li>
<p>Kerberos requires time synchronization between clients
and servers for correct operation. You should consider enabling ntpd.</p>
</li>
</ol>
<p>Be sure to back up the CA certificates stored in /root/cacert.p12
These files are required to create replicas. The password for these
files is the Directory Manager password
FreeIPA server does not run DNS server, skipping update-self-ip-address.
Created symlink /etc/systemd/system/container-ipa.target.wants/ipa-server-update-self-ip-address.service → /usr/lib/systemd/system/ipa-server-update-self-ip-address.service.
Created symlink /etc/systemd/system/container-ipa.target.wants/ipa-server-upgrade.service → /usr/lib/systemd/system/ipa-server-upgrade.service.
Removed /etc/systemd/system/container-ipa.target.wants/ipa-server-configure-first.service.
FreeIPA server configured.</p>
<p>{% endhighlight %}</p>
<p>Now the FreeIPA docker container is ready. Verify the status of running container.</p>
<p>{% highlight console %}</p>
<p>[root@fedora25 ~]# docker ps -a
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
30667326bf93 freeipa-server &ldquo;/usr/local/sbin/init&rdquo; 45 minutes ago Up 44 minutes 53/tcp, 80/tcp, 53/udp, 88/udp, 88/tcp, 389/tcp, 443/tcp, 123/udp, 464/tcp, 636/tcp, 7389/tcp, 9443-9445/tcp, 464/udp freeipa-server-container</p>
<p>{% endhighlight %}</p>
<h4 id="how-to-enroll-the-host-to-freeipa-running-in-container">How to enroll the host to FreeIPA running in container<a hidden class="anchor" aria-hidden="true" href="#how-to-enroll-the-host-to-freeipa-running-in-container">#</a></h4>
<p>We can also enroll the host to FreeIPA server running in container.Since i don&rsquo;t have DNS configured, i manually added the FreeIPA docker container IP to the local resolver file in host machine.</p>
<p>{% highlight console %}</p>
<p>[root@fedora25 ~]# docker inspect &ndash;format &lsquo;{{.NetworkSettings.IPAddress}}&rsquo; 1freeipa-server-container
172.17.0.2
[root@fedora25 ~]# cat /etc/hosts |grep freeipa
172.17.0.2 freeipa.vikki.in</p>
<p>{% endhighlight %}</p>
<p>Now install the ipa client in fedora host machine.</p>
<p>{% highlight console %}</p>
<p>[root@fedora25 ~]# ipa-client-install
WARNING: ntpd time&amp;date synchronization service will not be configured as
conflicting service (chronyd) is enabled
Use &ndash;force-ntpd option to disable it and force configuration of ntpd</p>
<p>DNS discovery failed to determine your DNS domain
Provide the domain name of your IPA server (ex: example.com): vikki.in
Provide your IPA server name (ex: ipa.example.com): freeipa.vikki.in
The failure to use DNS to find your IPA server indicates that your resolv.conf file is not properly configured.
Autodiscovery of servers for failover cannot work with this configuration.
If you proceed with the installation, services will be configured to always access the discovered server for all operations and will not fail over to other servers in case of failure.
Proceed with fixed values and no DNS discovery? [no]: yes
Client hostname: fedora25.vikki.in
Realm: VIKKI.IN
DNS Domain: vikki.in
IPA Server: freeipa.vikki.in
BaseDN: dc=vikki,dc=in</p>
<p>Continue to configure the system with these values? [no]: yes
Skipping synchronizing time with NTP server.
User authorized to enroll computers: admin
Password for <a href="mailto:admin@VIKKI.IN">admin@VIKKI.IN</a>:
Successfully retrieved CA cert
Subject: CN=Certificate Authority,O=VIKKI.IN
Issuer: CN=Certificate Authority,O=VIKKI.IN
Valid From: 2018-01-20 07:13:00
Valid Until: 2038-01-20 07:13:00</p>
<p>Enrolled in IPA realm VIKKI.IN
Created /etc/ipa/default.conf
New SSSD config will be created
Configured sudoers in /etc/nsswitch.conf
Configured /etc/sssd/sssd.conf
Configured /etc/krb5.conf for IPA realm VIKKI.IN
trying <a href="https://freeipa.vikki.in/ipa/json">https://freeipa.vikki.in/ipa/json</a>
[try 1]: Forwarding &lsquo;schema&rsquo; to json server &lsquo;<a href="https://freeipa.vikki.in/ipa/json%27">https://freeipa.vikki.in/ipa/json'</a>
trying <a href="https://freeipa.vikki.in/ipa/session/json">https://freeipa.vikki.in/ipa/session/json</a>
[try 1]: Forwarding &lsquo;ping&rsquo; to json server &lsquo;<a href="https://freeipa.vikki.in/ipa/session/json%27">https://freeipa.vikki.in/ipa/session/json'</a>
[try 1]: Forwarding &lsquo;ca_is_enabled&rsquo; to json server &lsquo;<a href="https://freeipa.vikki.in/ipa/session/json%27">https://freeipa.vikki.in/ipa/session/json'</a>
Systemwide CA database updated.
Hostname (fedora25.vikki.in) does not have A/AAAA record.
Failed to update DNS records.
Missing A/AAAA record(s) for host fedora25.vikki.in: 172.17.0.1.
Missing reverse record(s) for address(es): 172.17.0.1.
Adding SSH public key from /etc/ssh/ssh_host_rsa_key.pub
Adding SSH public key from /etc/ssh/ssh_host_ecdsa_key.pub
Adding SSH public key from /etc/ssh/ssh_host_ed25519_key.pub
[try 1]: Forwarding &lsquo;host_mod&rsquo; to json server &lsquo;<a href="https://freeipa.vikki.in/ipa/session/json%27">https://freeipa.vikki.in/ipa/session/json'</a>
Could not update DNS SSHFP records.
SSSD enabled
Configured /etc/openldap/ldap.conf
Configured /etc/ssh/ssh_config
Configured /etc/ssh/sshd_config
Configuring vikki.in as NIS domain.
Client configuration complete.
The ipa-client-install command was successful</p>
<p>{% endhighlight %}</p>
<p>Once client is installed and authenticated to the FreeIPA server, we can verify the hosts by login to GUI as shown below</p>
<!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="/content/images/2018/01/Screenshot-from-2018-01-20-13-22-56.png" class="kg-image" alt="Screenshot-from-2018-01-20-13-22-56"></figure><!--kg-card-end: image-->
<p>Verify the users are synced to the client.</p>
<p>{% highlight console %}</p>
<p>[root@fedora25 ~]# id vivek
uid=1661600001(vivek) gid=1661600001(vivek) groups=1661600001(vivek)
[root@fedora25 ~]#</p>
<p>{% endhighlight %}</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/linux/">Linux</a></li>
      <li><a href="http://localhost:1313/tags/opensource/">Opensource</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/2018-02-23-car_trip_to_hogenakkal/">
    <span class="title">« Prev</span>
    <br>
    <span>Coracle ride in river Cauvery - an adventurous car trip to Hogenakkal</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/2017-10-07-raspberry-pi-blinking-led-in-morse/">
    <span class="title">Next »</span>
    <br>
    <span>Raspberry pi – blinking led in morse</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FreeIPA Installation and configuration on x"
            href="https://x.com/intent/tweet/?text=FreeIPA%20Installation%20and%20configuration&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2017-10-07-freeipa_installation_configuration%2f&amp;hashtags=linux%2copensource">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FreeIPA Installation and configuration on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2017-10-07-freeipa_installation_configuration%2f&amp;title=FreeIPA%20Installation%20and%20configuration&amp;summary=FreeIPA%20Installation%20and%20configuration&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2f2017-10-07-freeipa_installation_configuration%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FreeIPA Installation and configuration on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2017-10-07-freeipa_installation_configuration%2f&title=FreeIPA%20Installation%20and%20configuration">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FreeIPA Installation and configuration on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2017-10-07-freeipa_installation_configuration%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FreeIPA Installation and configuration on whatsapp"
            href="https://api.whatsapp.com/send?text=FreeIPA%20Installation%20and%20configuration%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2f2017-10-07-freeipa_installation_configuration%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FreeIPA Installation and configuration on telegram"
            href="https://telegram.me/share/url?text=FreeIPA%20Installation%20and%20configuration&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2017-10-07-freeipa_installation_configuration%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FreeIPA Installation and configuration on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=FreeIPA%20Installation%20and%20configuration&u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2017-10-07-freeipa_installation_configuration%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Vignesh Ragupathy</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
