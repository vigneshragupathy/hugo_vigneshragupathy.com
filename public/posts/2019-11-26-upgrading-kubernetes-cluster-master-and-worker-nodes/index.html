<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Upgrading kubernetes cluster master and worker nodes | Vignesh Ragupathy</title>
<meta name="keywords" content="kubernetes, linux, opensource">
<meta name="description" content="This post we are going to discuss how to upgrade the kubernetes cluster, both master and worker nodes. We are going to upgrade a older version v1.15 to v.1.16.
Setup
I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.

Master node
Step 1: Verify the current version of kubelet and kubeadm running in all nodes
{% highlight console %}">
<meta name="author" content="Vignesh Ragupathy">
<link rel="canonical" href="http://localhost:1313/posts/2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes/">
  <meta property="og:site_name" content="Vignesh Ragupathy">
  <meta property="og:title" content="Upgrading kubernetes cluster master and worker nodes">
  <meta property="og:description" content="This post we are going to discuss how to upgrade the kubernetes cluster, both master and worker nodes. We are going to upgrade a older version v1.15 to v.1.16.
Setup I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.
Master node Step 1: Verify the current version of kubelet and kubeadm running in all nodes {% highlight console %}">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-11-26T15:07:58+00:00">
    <meta property="article:modified_time" content="2019-11-26T15:07:58+00:00">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Opensource">
      <meta property="og:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:title" content="Upgrading kubernetes cluster master and worker nodes">
<meta name="twitter:description" content="This post we are going to discuss how to upgrade the kubernetes cluster, both master and worker nodes. We are going to upgrade a older version v1.15 to v.1.16.
Setup
I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.

Master node
Step 1: Verify the current version of kubelet and kubeadm running in all nodes
{% highlight console %}">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Upgrading kubernetes cluster master and worker nodes",
      "item": "http://localhost:1313/posts/2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Upgrading kubernetes cluster master and worker nodes",
  "name": "Upgrading kubernetes cluster master and worker nodes",
  "description": "This post we are going to discuss how to upgrade the kubernetes cluster, both master and worker nodes. We are going to upgrade a older version v1.15 to v.1.16.\nSetup I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.\nMaster node Step 1: Verify the current version of kubelet and kubeadm running in all nodes {% highlight console %}\n",
  "keywords": [
    "kubernetes", "linux", "opensource"
  ],
  "articleBody": "This post we are going to discuss how to upgrade the kubernetes cluster, both master and worker nodes. We are going to upgrade a older version v1.15 to v.1.16.\nSetup I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.\nMaster node Step 1: Verify the current version of kubelet and kubeadm running in all nodes {% highlight console %}\nvikki@kubernetes1:~$ kubectl get nodes NAME STATUS ROLES AGE VERSION kubernetes1 Ready master 41d v1.15.5 kubernetes2 Ready 41d v1.15.5\n{% endhighlight %}{% highlight console %}\nvikki@kubernetes1:~$ kubeadm version kubeadm version: \u0026version.Info{Major:“1”, Minor:“15”, GitVersion:“v1.15.5”, GitCommit:“20c265fef0741dd71a66480e35bd69f18351daea”, GitTreeState:“clean”, BuildDate:“2019-10-15T19:14:19Z”, GoVersion:“go1.12.10”, Compiler:“gc”, Platform:“linux/amd64”}\n{% endhighlight %}\nWe can see kubelet and kubeadm is running in version v1.15.5\nStep 2: Verify the lastest stable availble version Run the update in kubernetes master node\n{% highlight console %}\nroot@kubernetes1:~# apt update\n{% endhighlight %}{% highlight console %}\nroot@kubernetes1:~# apt-cache policy kubeadm kubeadm: Installed: 1.15.5-00 Candidate: 1.16.3-00 Version table: …..\n{% endhighlight %}\nWe can see from this output that current version is 1.15.5 and the latest available is 1.16.3\nStep 3: Upgrade the kubeadm to latest version Upgrade the kubeadm in master to the latest version 1.16.3\n{% highlight console %}\nroot@kubernetes1:~# apt-mark unhold kubeadm \u0026\u0026 \\\napt-get update \u0026\u0026 apt-get install -y kubeadm=1.16.3-00 \u0026\u0026 apt-mark hold kubeadm kubeadm was already not hold. Hit:1 http://us.archive.ubuntu.com/ubuntu xenial InRelease Hit:2 http://security.ubuntu.com/ubuntu xenial-security InRelease Hit:3 http://us.archive.ubuntu.com/ubuntu xenial-updates InRelease Hit:4 http://us.archive.ubuntu.com/ubuntu xenial-backports InRelease Hit:5 https://apt.kubernetes.io kubernetes-xenial InRelease Reading package lists… Done Reading package lists… Done Building dependency tree Reading state information… Done The following packages will be upgraded: kubeadm 1 upgraded, 0 newly installed, 0 to remove and 142 not upgraded. Need to get 8,762 kB of archives. After this operation, 4,062 kB of additional disk space will be used. Get:1 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubeadm amd64 1.16.3-00 [8,762 kB] Fetched 8,762 kB in 7s (1,117 kB/s) (Reading database … 60808 files and directories currently installed.) Preparing to unpack …/kubeadm_1.16.3-00_amd64.deb … Unpacking kubeadm (1.16.3-00) over (1.15.5-00) … Setting up kubeadm (1.16.3-00) … kubeadm set on hold.\n{% endhighlight %}\nStep 4: Run the upgrade plan Now in the previous step we already updated the kubeadm to latest version. Now lets run the upgrade plan and see the available options.\n{% highlight console %}\nroot@kubernetes1:~# sudo kubeadm upgrade plan [upgrade/config] Making sure the configuration is correct: [upgrade/config] Reading configuration from the cluster… [upgrade/config] FYI: You can look at this config file with ‘kubectl -n kube-system get cm kubeadm-config -oyaml’ [preflight] Running pre-flight checks. [upgrade] Making sure the cluster is healthy: [upgrade] Fetching available versions to upgrade to [upgrade/versions] Cluster version: v1.15.5 [upgrade/versions] kubeadm version: v1.16.3 [upgrade/versions] Latest stable version: v1.16.3 [upgrade/versions] Latest version in the v1.15 series: v1.15.6\nComponents that must be upgraded manually after you have upgraded the control plane with ‘kubeadm upgrade apply’: COMPONENT CURRENT AVAILABLE Kubelet 2 x v1.15.5 v1.15.6\nUpgrade to the latest version in the v1.15 series:\nCOMPONENT CURRENT AVAILABLE API Server v1.15.5 v1.15.6 Controller Manager v1.15.5 v1.15.6 Scheduler v1.15.5 v1.15.6 Kube Proxy v1.15.5 v1.15.6 CoreDNS 1.3.1 1.6.2 Etcd 3.3.10 3.3.10\nYou can now apply the upgrade by executing the following command:\nkubeadm upgrade apply v1.15.6 Components that must be upgraded manually after you have upgraded the control plane with ‘kubeadm upgrade apply’: COMPONENT CURRENT AVAILABLE Kubelet 2 x v1.15.5 v1.16.3\nUpgrade to the latest stable version:\nCOMPONENT CURRENT AVAILABLE API Server v1.15.5 v1.16.3 Controller Manager v1.15.5 v1.16.3 Scheduler v1.15.5 v1.16.3 Kube Proxy v1.15.5 v1.16.3 CoreDNS 1.3.1 1.6.2 Etcd 3.3.10 3.3.15-0\nYou can now apply the upgrade by executing the following command:\nkubeadm upgrade apply v1.16.3 {% endhighlight %}\nWe can see that we can upgrade the cluster to v1.16.3 from the above output\nStep 5: Drain the pods in master node Now drain all the pods execpt daemonsets in the master node\n{% highlight console %}\nvikki@kubernetes1:~$ kubectl drain kubernetes1 –ignore-daemonsets node/kubernetes1 cordoned WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-flannel-ds-amd64-bfr9j, kube-system/kube-proxy-8267n evicting pod “coredns-5c98db65d4-v4cms” evicting pod “coredns-5c98db65d4-g4gv4” pod/coredns-5c98db65d4-v4cms evicted pod/coredns-5c98db65d4-g4gv4 evicted node/kubernetes1 evicted\n{% endhighlight %}\nStep 6: Run the upgrade Now run the upgrade to the lastest version 1.16.3\n{% highlight console %}\nvikki@kubernetes1:~$ sudo kubeadm upgrade apply v1.16.3 [upgrade/config] Making sure the configuration is correct: [upgrade/config] Reading configuration from the cluster… [upgrade/config] FYI: You can look at this config file with ‘kubectl -n kube-system get cm kubeadm-config -oyaml’ [preflight] Running pre-flight checks. [upgrade] Making sure the cluster is healthy: [upgrade/version] You have chosen to change the cluster version to “v1.16.3” [upgrade/versions] Cluster version: v1.15.5 [upgrade/versions] kubeadm version: v1.16.3 [upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y [upgrade/prepull] Will prepull images for components [kube-apiserver kube-controller-manager kube-scheduler etcd] [upgrade/prepull] Prepulling image for component etcd. [upgrade/prepull] Prepulling image for component kube-apiserver. [upgrade/prepull] Prepulling image for component kube-controller-manager. [upgrade/prepull] Prepulling image for component kube-scheduler. [apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-etcd [apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler [apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-controller-manager [apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-apiserver [apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-etcd [apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler [upgrade/prepull] Prepulled image for component etcd. [upgrade/prepull] Prepulled image for component kube-apiserver. [upgrade/prepull] Prepulled image for component kube-controller-manager. [upgrade/prepull] Prepulled image for component kube-scheduler. [upgrade/prepull] Successfully prepulled the images for all the control plane components [upgrade/apply] Upgrading your Static Pod-hosted control plane to version “v1.16.3”… Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e Static pod: kube-controller-manager-kubernetes1 hash: f106f0d94b93b77e4db974b1c477d277 Static pod: kube-scheduler-kubernetes1 hash: 131c3f63daec7c0750818f64a2f75d20 [upgrade/etcd] Upgrading to TLS for etcd Static pod: etcd-kubernetes1 hash: 352a2620657e49493504dc8f27c83195 [upgrade/staticpods] Preparing for “etcd” upgrade [upgrade/staticpods] Renewing etcd-server certificate [upgrade/staticpods] Renewing etcd-peer certificate [upgrade/staticpods] Renewing etcd-healthcheck-client certificate [upgrade/staticpods] Moved new manifest to “/etc/kubernetes/manifests/etcd.yaml” and backed up old manifest to “/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/etcd.yaml” [upgrade/staticpods] Waiting for the kubelet to restart the component [upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s) Static pod: etcd-kubernetes1 hash: 352a2620657e49493504dc8f27c83195 Static pod: etcd-kubernetes1 hash: 3ce412f7cfe0c06939809c93f738e798 [apiclient] Found 1 Pods for label selector component=etcd [upgrade/staticpods] Component “etcd” upgraded successfully! [upgrade/etcd] Waiting for etcd to become available [upgrade/staticpods] Writing new Static Pod manifests to “/etc/kubernetes/tmp/kubeadm-upgraded-manifests001214141” [upgrade/staticpods] Preparing for “kube-apiserver” upgrade [upgrade/staticpods] Renewing apiserver certificate [upgrade/staticpods] Renewing apiserver-kubelet-client certificate [upgrade/staticpods] Renewing front-proxy-client certificate [upgrade/staticpods] Renewing apiserver-etcd-client certificate [upgrade/staticpods] Moved new manifest to “/etc/kubernetes/manifests/kube-apiserver.yaml” and backed up old manifest to “/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/kube-apiserver.yaml” [upgrade/staticpods] Waiting for the kubelet to restart the component [upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s) Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e Static pod: kube-apiserver-kubernetes1 hash: d8708cb2f25dd11bbb41dd9729149325 [apiclient] Found 1 Pods for label selector component=kube-apiserver [upgrade/staticpods] Component “kube-apiserver” upgraded successfully! [upgrade/staticpods] Preparing for “kube-controller-manager” upgrade [upgrade/staticpods] Renewing controller-manager.conf certificate [upgrade/staticpods] Moved new manifest to “/etc/kubernetes/manifests/kube-controller-manager.yaml” and backed up old manifest to “/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/kube-controller-manager.yaml” [upgrade/staticpods] Waiting for the kubelet to restart the component [upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s) Static pod: kube-controller-manager-kubernetes1 hash: f106f0d94b93b77e4db974b1c477d277 Static pod: kube-controller-manager-kubernetes1 hash: e6e76bb8264f2e84070efada35e93e71 [apiclient] Found 1 Pods for label selector component=kube-controller-manager [upgrade/staticpods] Component “kube-controller-manager” upgraded successfully! [upgrade/staticpods] Preparing for “kube-scheduler” upgrade [upgrade/staticpods] Renewing scheduler.conf certificate [upgrade/staticpods] Moved new manifest to “/etc/kubernetes/manifests/kube-scheduler.yaml” and backed up old manifest to “/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/kube-scheduler.yaml” [upgrade/staticpods] Waiting for the kubelet to restart the component [upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s) Static pod: kube-scheduler-kubernetes1 hash: 131c3f63daec7c0750818f64a2f75d20 Static pod: kube-scheduler-kubernetes1 hash: 8c5e33e50bb56e8adacd1cc99c56b2cb [apiclient] Found 1 Pods for label selector component=kube-scheduler [upgrade/staticpods] Component “kube-scheduler” upgraded successfully! [upload-config] Storing the configuration used in ConfigMap “kubeadm-config” in the “kube-system” Namespace [kubelet] Creating a ConfigMap “kubelet-config-1.16” in namespace kube-system with the configuration for the kubelets in the cluster [kubelet-start] Downloading configuration for the kubelet from the “kubelet-config-1.16” ConfigMap in the kube-system namespace [kubelet-start] Writing kubelet configuration to file “/var/lib/kubelet/config.yaml” [bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials [bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token [bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster [addons] Applied essential addon: CoreDNS [addons] Applied essential addon: kube-proxy\n[upgrade/successful] SUCCESS! Your cluster was upgraded to “v1.16.3”. Enjoy!\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven’t already done so.\n{% endhighlight %}\nWe can see the cluster is upgraded to lastest version v1.16.3\nStep 7: Uncordon the master node Now ucordon the master node\n{% highlight console %}\nvikki@kubernetes1:~$ kubectl uncordon kubernetes1 node/kubernetes1 uncordoned\n{% endhighlight %}\nStep 8: Upgrade the kubelet Now in the previous steps we have upgraded the kubeadm and cluster , next we need to upgrade the kubelet and kubectl\n{% highlight console %}\nroot@kubernetes1:~# apt-mark unhold kubelet kubectl \u0026\u0026 \\\napt-get update \u0026\u0026 apt-get install -y kubelet=1.16.3-00 kubectl=1.16.3-00 \u0026\u0026 apt-mark hold kubelet kubectl kubelet was already not hold. kubectl was already not hold. Hit:1 http://security.ubuntu.com/ubuntu xenial-security InRelease Hit:2 http://us.archive.ubuntu.com/ubuntu xenial InRelease Hit:3 http://us.archive.ubuntu.com/ubuntu xenial-updates InRelease Hit:4 http://us.archive.ubuntu.com/ubuntu xenial-backports InRelease Hit:5 https://apt.kubernetes.io kubernetes-xenial InRelease Reading package lists… Done Reading package lists… Done Building dependency tree Reading state information… Done The following packages will be upgraded: kubectl kubelet 2 upgraded, 0 newly installed, 0 to remove and 140 not upgraded. Need to get 29.9 MB of archives. After this operation, 7,134 kB of additional disk space will be used. Get:1 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubectl amd64 1.16.3-00 [9,233 kB] Get:2 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubelet amd64 1.16.3-00 [20.7 MB] Fetched 29.9 MB in 8s (3,436 kB/s) (Reading database … 60808 files and directories currently installed.) Preparing to unpack …/kubectl_1.16.3-00_amd64.deb … Unpacking kubectl (1.16.3-00) over (1.15.5-00) … Preparing to unpack …/kubelet_1.16.3-00_amd64.deb … Unpacking kubelet (1.16.3-00) over (1.15.5-00) … Setting up kubectl (1.16.3-00) … Setting up kubelet (1.16.3-00) … kubelet set on hold. kubectl set on hold.\n{% endhighlight %}\nRestart the kubelet service\n{% highlight console %}\nroot@kubernetes1:~# sudo systemctl restart kubelet\n{% endhighlight %}{% highlight console %}\nvikki@kubernetes1:~$ kubectl get nodes NAME STATUS ROLES AGE VERSION kubernetes1 Ready master 41d v1.16.3 kubernetes2 Ready 41d v1.15.5\n{% endhighlight %}\nNow we can see the master node kubernetes1 is upgraded to v1.16.3\nWorker node Step 1: Upgrade the kubeadm to version 1.16.3 {% highlight console %}\nroot@kubernetes2:~# apt-mark unhold kubeadm \u0026\u0026 \\\napt-get update \u0026\u0026 apt-get install -y kubeadm=1.16.3-00 \u0026\u0026 apt-mark hold kubeadm kubeadm was already not hold. Get:1 http://security.ubuntu.com/ubuntu xenial-security InRelease [109 kB] Get:2 http://security.ubuntu.com/ubuntu xenial-security/main amd64 Packages [785 kB] Hit:3 http://us.archive.ubuntu.com/ubuntu xenial InRelease Get:4 http://us.archive.ubuntu.com/ubuntu xenial-updates InRelease [109 kB] Get:5 https://apt.kubernetes.io kubernetes-xenial InRelease [161 B] Get:6 https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages [31.3 kB] Get:7 http://us.archive.ubuntu.com/ubuntu xenial-backports InRelease [107 kB] Get:8 http://us.archive.ubuntu.com/ubuntu xenial-updates/main amd64 Packages [1,071 kB] Get:9 http://security.ubuntu.com/ubuntu xenial-security/main i386 Packages [617 kB] Get:10 http://security.ubuntu.com/ubuntu xenial-security/main Translation-en [302 kB] Get:11 http://security.ubuntu.com/ubuntu xenial-security/universe amd64 Packages [466 kB] Get:12 http://us.archive.ubuntu.com/ubuntu xenial-updates/main i386 Packages [882 kB] Get:13 http://security.ubuntu.com/ubuntu xenial-security/universe i386 Packages [401 kB] Get:14 http://security.ubuntu.com/ubuntu xenial-security/universe Translation-en [191 kB] Get:15 http://security.ubuntu.com/ubuntu xenial-security/multiverse amd64 Packages [5,724 B] Get:16 http://security.ubuntu.com/ubuntu xenial-security/multiverse i386 Packages [5,888 B] Get:17 http://us.archive.ubuntu.com/ubuntu xenial-updates/main Translation-en [413 kB] Get:18 http://us.archive.ubuntu.com/ubuntu xenial-updates/universe amd64 Packages [771 kB] Get:19 http://us.archive.ubuntu.com/ubuntu xenial-updates/universe i386 Packages [700 kB] Get:20 http://us.archive.ubuntu.com/ubuntu xenial-updates/universe Translation-en [324 kB] Get:21 http://us.archive.ubuntu.com/ubuntu xenial-updates/multiverse amd64 Packages [16.8 kB] Get:22 http://us.archive.ubuntu.com/ubuntu xenial-updates/multiverse i386 Packages [15.9 kB] Fetched 7,333 kB in 23s (315 kB/s) Reading package lists… Done Reading package lists… Done Building dependency tree Reading state information… Done The following packages will be upgraded: kubeadm 1 upgraded, 0 newly installed, 0 to remove and 139 not upgraded. Need to get 8,762 kB of archives. After this operation, 4,062 kB of additional disk space will be used. Get:1 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubeadm amd64 1.16.3-00 [8,762 kB] Fetched 8,762 kB in 7s (1,122 kB/s) (Reading database … 60808 files and directories currently installed.) Preparing to unpack …/kubeadm_1.16.3-00_amd64.deb … Unpacking kubeadm (1.16.3-00) over (1.15.5-00) … Setting up kubeadm (1.16.3-00) … kubeadm set on hold.\n{% endhighlight %}\nStep 2: Drain the pods in worker node Now drain all the pods , except daemonsets from the worker node kubernetes2. This command should be run in master node in case the kubenetes config is not mapped in worker.\n{% highlight console %}\nvikki@kubernetes1:~$ kubectl drain kubernetes2 –ignore-daemonsets node/kubernetes2 cordoned WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-flannel-ds-amd64-8v6lb, kube-system/kube-proxy-877b2 evicting pod “coredns-5644d7b6d9-t8qw5” evicting pod “httpd-7765f5994-gvlj6” evicting pod “nginx-7bffc778db-phdb5” evicting pod “coredns-5644d7b6d9-frz4v” pod/coredns-5644d7b6d9-frz4v evicted pod/coredns-5644d7b6d9-t8qw5 evicted pod/httpd-7765f5994-gvlj6 evicted pod/nginx-7bffc778db-phdb5 evicted node/kubernetes2 evicted\n{% endhighlight %}\nStep 3: Upgrade the worker node {% highlight console %}\nroot@kubernetes2:~# sudo kubeadm upgrade node [upgrade] Reading configuration from the cluster… [upgrade] FYI: You can look at this config file with ‘kubectl -n kube-system get cm kubeadm-config -oyaml’ [upgrade] Skipping phase. Not a control plane node[kubelet-start] Downloading configuration for the kubelet from the “kubelet-config-1.16” ConfigMap in the kube-system namespace [kubelet-start] Writing kubelet configuration to file “/var/lib/kubelet/config.yaml” [upgrade] The configuration for this node was successfully updated! [upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.\n{% endhighlight %}\nStep 4: Upgrade the kubelet and kubectl In previous steps we upgraded the kubeadm and cluster. Now we need to upgrade the kubelet and kubectl.\n{% highlight console %}\nroot@kubernetes2:~# apt-mark unhold kubelet kubectl \u0026\u0026 \\\napt-get update \u0026\u0026 apt-get install -y kubelet=1.16.3-00 kubectl=1.16.3-00 \u0026\u0026 apt-mark hold kubelet kubectl kubelet was already not hold. kubectl was already not hold. Hit:1 http://security.ubuntu.com/ubuntu xenial-security InRelease Hit:2 http://us.archive.ubuntu.com/ubuntu xenial InRelease Hit:3 http://us.archive.ubuntu.com/ubuntu xenial-updates InRelease Hit:4 http://us.archive.ubuntu.com/ubuntu xenial-backports InRelease Hit:5 https://apt.kubernetes.io kubernetes-xenial InRelease Reading package lists… Done Reading package lists… Done Building dependency tree Reading state information… Done The following packages will be upgraded: kubectl kubelet 2 upgraded, 0 newly installed, 0 to remove and 137 not upgraded. Need to get 29.9 MB of archives. After this operation, 3,447 kB of additional disk space will be used. Get:1 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubectl amd64 1.16.3-00 [9,233 kB] Get:2 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubelet amd64 1.16.3-00 [20.7 MB] Fetched 29.9 MB in 32s (934 kB/s) (Reading database … 60808 files and directories currently installed.) Preparing to unpack …/kubectl_1.16.3-00_amd64.deb … Unpacking kubectl (1.16.3-00) over (1.16.2-00) … Preparing to unpack …/kubelet_1.16.3-00_amd64.deb … Unpacking kubelet (1.16.3-00) over (1.15.5-00) … Setting up kubectl (1.16.3-00) … Setting up kubelet (1.16.3-00) … kubelet set on hold. kubectl set on hold.\n{% endhighlight %}\nRestart the kubelet service in worker node\n{% highlight console %}\nroot@kubernetes2:~# sudo systemctl restart kubelet\n{% endhighlight %}\nStep 5: Uncordon the worker node Now uncordon all the pods in kubernetes2 worker onde\n{% highlight console %}\nvikki@kubernetes1:~$ kubectl uncordon kubernetes2 node/kubernetes2 uncordoned\n{% endhighlight %}{% highlight console %}\nvikki@kubernetes1:~$ kubectl get nodes NAME STATUS ROLES AGE VERSION kubernetes1 Ready master 41d v1.16.3 kubernetes2 Ready 41d v1.16.3\n{% endhighlight %}\nWe can see now both the master and worker nodes are upgraded from v1.15.5 to v1.16.3\n",
  "wordCount" : "2460",
  "inLanguage": "en",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2019-11-26T15:07:58Z",
  "dateModified": "2019-11-26T15:07:58Z",
  "author":{
    "@type": "Person",
    "name": "Vignesh Ragupathy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Vignesh Ragupathy",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Vignesh Ragupathy (Alt + H)">Vignesh Ragupathy</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://localhost:1313/fr/" title="French"
                            aria-label=":fr:">🇫🇷</a>
                    </li>
                    <li>
                        <a href="http://localhost:1313/fa/" title="Fa"
                            aria-label="Fa">Fa</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Upgrading kubernetes cluster master and worker nodes
    </h1>
    <div class="post-meta"><span title='2019-11-26 15:07:58 +0000 UTC'>November 26, 2019</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;Vignesh Ragupathy&nbsp;|&nbsp;<a href="https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content/posts/2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes.markdown" rel="noopener noreferrer edit" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#setup" aria-label="Setup">Setup</a></li>
                <li>
                    <a href="#master-node" aria-label="Master node">Master node</a><ul>
                        <ul>
                        
                <li>
                    <a href="#step-1-verify-the-current-version-of-kubelet-and-kubeadm-running-in-all-nodes" aria-label="Step 1: Verify the current version of kubelet and kubeadm running in all nodes">Step 1: Verify the current version of kubelet and kubeadm running in all nodes</a></li>
                <li>
                    <a href="#step-2-verify-the-lastest-stable-availble-version" aria-label="Step 2: Verify the lastest stable availble version">Step 2: Verify the lastest stable availble version</a></li>
                <li>
                    <a href="#step-3-upgrade-the-kubeadm-to-latest-version" aria-label="Step 3: Upgrade the kubeadm to latest version">Step 3: Upgrade the kubeadm to latest version</a></li>
                <li>
                    <a href="#step-4-run-the-upgrade-plan" aria-label="Step 4: Run the upgrade plan">Step 4: Run the upgrade plan</a></li>
                <li>
                    <a href="#step-5-drain-the-pods-in-master-node" aria-label="Step 5: Drain the pods in master node">Step 5: Drain the pods in master node</a></li>
                <li>
                    <a href="#step-6-run-the-upgrade" aria-label="Step 6: Run the upgrade">Step 6: Run the upgrade</a></li>
                <li>
                    <a href="#step-7-uncordon-the-master-node" aria-label="Step 7: Uncordon the master node">Step 7: Uncordon the master node</a></li>
                <li>
                    <a href="#step-8-upgrade-the-kubelet" aria-label="Step 8: Upgrade the kubelet">Step 8: Upgrade the kubelet</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#worker-node" aria-label="Worker node">Worker node</a><ul>
                        <ul>
                        
                <li>
                    <a href="#step-1-upgrade-the-kubeadm-to-version-1163" aria-label="Step 1: Upgrade the kubeadm to version 1.16.3">Step 1: Upgrade the kubeadm to version 1.16.3</a></li>
                <li>
                    <a href="#step-2-drain-the-pods-in-worker-node" aria-label="Step 2: Drain the pods in worker node">Step 2: Drain the pods in worker node</a></li>
                <li>
                    <a href="#step-3-upgrade-the-worker-node" aria-label="Step 3: Upgrade the worker node">Step 3: Upgrade the worker node</a></li>
                <li>
                    <a href="#step-4-upgrade-the-kubelet-and-kubectl" aria-label="Step 4: Upgrade the kubelet and kubectl">Step 4: Upgrade the kubelet and kubectl</a></li>
                <li>
                    <a href="#step-5-uncordon-the-worker-node" aria-label="Step 5: Uncordon the worker node">Step 5: Uncordon the worker node</a>
                </li>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>This post we are going to discuss how to upgrade the kubernetes cluster, both master and worker nodes. We are going to upgrade a older version v1.15 to v.1.16.</p>
<h3 id="setup"><strong>Setup</strong><a hidden class="anchor" aria-hidden="true" href="#setup">#</a></h3>
<p>I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.</p>
<!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="/content/images/2019/11/setup-5.jpg" class="kg-image"></figure><!--kg-card-end: image-->
<h3 id="master-node">Master node<a hidden class="anchor" aria-hidden="true" href="#master-node">#</a></h3>
<h5 id="step-1-verify-the-current-version-of-kubelet-and-kubeadm-running-in-all-nodes">Step 1: Verify the current version of kubelet and kubeadm running in all nodes<a hidden class="anchor" aria-hidden="true" href="#step-1-verify-the-current-version-of-kubelet-and-kubeadm-running-in-all-nodes">#</a></h5>
<p>{% highlight console %}</p>
<p>vikki@kubernetes1:~$ kubectl get nodes
NAME STATUS ROLES AGE VERSION
kubernetes1 Ready master 41d v1.15.5
kubernetes2 Ready <none> 41d v1.15.5</p>
<p>{% endhighlight %}{% highlight console %}</p>
<p>vikki@kubernetes1:~$ kubeadm version
kubeadm version: &amp;version.Info{Major:&ldquo;1&rdquo;, Minor:&ldquo;15&rdquo;, GitVersion:&ldquo;v1.15.5&rdquo;, GitCommit:&ldquo;20c265fef0741dd71a66480e35bd69f18351daea&rdquo;, GitTreeState:&ldquo;clean&rdquo;, BuildDate:&ldquo;2019-10-15T19:14:19Z&rdquo;, GoVersion:&ldquo;go1.12.10&rdquo;, Compiler:&ldquo;gc&rdquo;, Platform:&ldquo;linux/amd64&rdquo;}</p>
<p>{% endhighlight %}</p>
<blockquote>
<p>We can see kubelet and kubeadm is running in version v1.15.5</p></blockquote>
<h5 id="step-2-verify-the-lastest-stable-availble-version">Step 2: Verify the lastest stable availble version<a hidden class="anchor" aria-hidden="true" href="#step-2-verify-the-lastest-stable-availble-version">#</a></h5>
<p>Run the update in kubernetes master node</p>
<p>{% highlight console %}</p>
<p>root@kubernetes1:~# apt update</p>
<p>{% endhighlight %}{% highlight console %}</p>
<p>root@kubernetes1:~# apt-cache policy kubeadm
kubeadm:
Installed: 1.15.5-00
Candidate: 1.16.3-00
Version table:
&hellip;..</p>
<p>{% endhighlight %}</p>
<blockquote>
<p>We can see from this output that current version is 1.15.5 and the latest available is 1.16.3</p></blockquote>
<h5 id="step-3-upgrade-the-kubeadm-to-latest-version">Step 3: Upgrade the kubeadm to latest version<a hidden class="anchor" aria-hidden="true" href="#step-3-upgrade-the-kubeadm-to-latest-version">#</a></h5>
<p>Upgrade the kubeadm in master to the latest version 1.16.3</p>
<p>{% highlight console %}</p>
<p>root@kubernetes1:~# apt-mark unhold kubeadm &amp;&amp; \</p>
<blockquote>
<p>apt-get update &amp;&amp; apt-get install -y kubeadm=1.16.3-00 &amp;&amp; <br>
apt-mark hold kubeadm
kubeadm was already not hold.
Hit:1 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial InRelease               <br>
Hit:2 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security InRelease
Hit:3 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates InRelease
Hit:4 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-backports InRelease
Hit:5 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial InRelease
Reading package lists&hellip; Done
Reading package lists&hellip; Done
Building dependency tree    <br>
Reading state information&hellip; Done
The following packages will be upgraded:
kubeadm
1 upgraded, 0 newly installed, 0 to remove and 142 not upgraded.
Need to get 8,762 kB of archives.
After this operation, 4,062 kB of additional disk space will be used.
Get:1 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial/main amd64 kubeadm amd64 1.16.3-00 [8,762 kB]
Fetched 8,762 kB in 7s (1,117 kB/s)                                                                                                                       <br>
(Reading database &hellip; 60808 files and directories currently installed.)
Preparing to unpack &hellip;/kubeadm_1.16.3-00_amd64.deb &hellip;
Unpacking kubeadm (1.16.3-00) over (1.15.5-00) &hellip;
Setting up kubeadm (1.16.3-00) &hellip;
kubeadm set on hold.</p></blockquote>
<p>{% endhighlight %}</p>
<h5 id="step-4-run-the-upgrade-plan">Step 4: Run the upgrade plan<a hidden class="anchor" aria-hidden="true" href="#step-4-run-the-upgrade-plan">#</a></h5>
<p>Now in the previous step we already updated the kubeadm to latest version. Now lets run the upgrade plan and see the available options.</p>
<p>{% highlight console %}</p>
<p>root@kubernetes1:~# sudo kubeadm upgrade plan
[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster&hellip;
[upgrade/config] FYI: You can look at this config file with &lsquo;kubectl -n kube-system get cm kubeadm-config -oyaml&rsquo;
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade] Fetching available versions to upgrade to
[upgrade/versions] Cluster version: v1.15.5
[upgrade/versions] kubeadm version: v1.16.3
[upgrade/versions] Latest stable version: v1.16.3
[upgrade/versions] Latest version in the v1.15 series: v1.15.6</p>
<p>Components that must be upgraded manually after you have upgraded the control plane with &lsquo;kubeadm upgrade apply&rsquo;:
COMPONENT CURRENT AVAILABLE
Kubelet 2 x v1.15.5 v1.15.6</p>
<p>Upgrade to the latest version in the v1.15 series:</p>
<p>COMPONENT CURRENT AVAILABLE
API Server v1.15.5 v1.15.6
Controller Manager v1.15.5 v1.15.6
Scheduler v1.15.5 v1.15.6
Kube Proxy v1.15.5 v1.15.6
CoreDNS 1.3.1 1.6.2
Etcd 3.3.10 3.3.10</p>
<p>You can now apply the upgrade by executing the following command:</p>
<pre><code>kubeadm upgrade apply v1.15.6
</code></pre>
<hr>
<p>Components that must be upgraded manually after you have upgraded the control plane with &lsquo;kubeadm upgrade apply&rsquo;:
COMPONENT CURRENT AVAILABLE
Kubelet 2 x v1.15.5 v1.16.3</p>
<p>Upgrade to the latest stable version:</p>
<p>COMPONENT CURRENT AVAILABLE
API Server v1.15.5 v1.16.3
Controller Manager v1.15.5 v1.16.3
Scheduler v1.15.5 v1.16.3
Kube Proxy v1.15.5 v1.16.3
CoreDNS 1.3.1 1.6.2
Etcd 3.3.10 3.3.15-0</p>
<p>You can now apply the upgrade by executing the following command:</p>
<pre><code>kubeadm upgrade apply v1.16.3
</code></pre>
<hr>
<p>{% endhighlight %}</p>
<blockquote>
<p>We can see that we can upgrade the cluster to v1.16.3 from the above output</p></blockquote>
<h5 id="step-5-drain-the-pods-in-master-node">Step 5: Drain the pods in master node<a hidden class="anchor" aria-hidden="true" href="#step-5-drain-the-pods-in-master-node">#</a></h5>
<p>Now drain all the pods execpt daemonsets in the master node</p>
<p>{% highlight console %}</p>
<p>vikki@kubernetes1:~$ kubectl drain kubernetes1 &ndash;ignore-daemonsets
node/kubernetes1 cordoned
WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-flannel-ds-amd64-bfr9j, kube-system/kube-proxy-8267n
evicting pod &ldquo;coredns-5c98db65d4-v4cms&rdquo;
evicting pod &ldquo;coredns-5c98db65d4-g4gv4&rdquo;
pod/coredns-5c98db65d4-v4cms evicted
pod/coredns-5c98db65d4-g4gv4 evicted
node/kubernetes1 evicted</p>
<p>{% endhighlight %}</p>
<h5 id="step-6-run-the-upgrade">Step 6: Run the upgrade<a hidden class="anchor" aria-hidden="true" href="#step-6-run-the-upgrade">#</a></h5>
<p>Now run the upgrade to the lastest version 1.16.3</p>
<p>{% highlight console %}</p>
<p>vikki@kubernetes1:~$ sudo kubeadm upgrade apply v1.16.3
[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster&hellip;
[upgrade/config] FYI: You can look at this config file with &lsquo;kubectl -n kube-system get cm kubeadm-config -oyaml&rsquo;
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade/version] You have chosen to change the cluster version to &ldquo;v1.16.3&rdquo;
[upgrade/versions] Cluster version: v1.15.5
[upgrade/versions] kubeadm version: v1.16.3
[upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y
[upgrade/prepull] Will prepull images for components [kube-apiserver kube-controller-manager kube-scheduler etcd]
[upgrade/prepull] Prepulling image for component etcd.
[upgrade/prepull] Prepulling image for component kube-apiserver.
[upgrade/prepull] Prepulling image for component kube-controller-manager.
[upgrade/prepull] Prepulling image for component kube-scheduler.
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-etcd
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-controller-manager
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-apiserver
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-etcd
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler
[upgrade/prepull] Prepulled image for component etcd.
[upgrade/prepull] Prepulled image for component kube-apiserver.
[upgrade/prepull] Prepulled image for component kube-controller-manager.
[upgrade/prepull] Prepulled image for component kube-scheduler.
[upgrade/prepull] Successfully prepulled the images for all the control plane components
[upgrade/apply] Upgrading your Static Pod-hosted control plane to version &ldquo;v1.16.3&rdquo;&hellip;
Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e
Static pod: kube-controller-manager-kubernetes1 hash: f106f0d94b93b77e4db974b1c477d277
Static pod: kube-scheduler-kubernetes1 hash: 131c3f63daec7c0750818f64a2f75d20
[upgrade/etcd] Upgrading to TLS for etcd
Static pod: etcd-kubernetes1 hash: 352a2620657e49493504dc8f27c83195
[upgrade/staticpods] Preparing for &ldquo;etcd&rdquo; upgrade
[upgrade/staticpods] Renewing etcd-server certificate
[upgrade/staticpods] Renewing etcd-peer certificate
[upgrade/staticpods] Renewing etcd-healthcheck-client certificate
[upgrade/staticpods] Moved new manifest to &ldquo;/etc/kubernetes/manifests/etcd.yaml&rdquo; and backed up old manifest to &ldquo;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/etcd.yaml&rdquo;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: etcd-kubernetes1 hash: 352a2620657e49493504dc8f27c83195
Static pod: etcd-kubernetes1 hash: 3ce412f7cfe0c06939809c93f738e798
[apiclient] Found 1 Pods for label selector component=etcd
[upgrade/staticpods] Component &ldquo;etcd&rdquo; upgraded successfully!
[upgrade/etcd] Waiting for etcd to become available
[upgrade/staticpods] Writing new Static Pod manifests to &ldquo;/etc/kubernetes/tmp/kubeadm-upgraded-manifests001214141&rdquo;
[upgrade/staticpods] Preparing for &ldquo;kube-apiserver&rdquo; upgrade
[upgrade/staticpods] Renewing apiserver certificate
[upgrade/staticpods] Renewing apiserver-kubelet-client certificate
[upgrade/staticpods] Renewing front-proxy-client certificate
[upgrade/staticpods] Renewing apiserver-etcd-client certificate
[upgrade/staticpods] Moved new manifest to &ldquo;/etc/kubernetes/manifests/kube-apiserver.yaml&rdquo; and backed up old manifest to &ldquo;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/kube-apiserver.yaml&rdquo;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e
Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e
Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e
Static pod: kube-apiserver-kubernetes1 hash: d8708cb2f25dd11bbb41dd9729149325
[apiclient] Found 1 Pods for label selector component=kube-apiserver
[upgrade/staticpods] Component &ldquo;kube-apiserver&rdquo; upgraded successfully!
[upgrade/staticpods] Preparing for &ldquo;kube-controller-manager&rdquo; upgrade
[upgrade/staticpods] Renewing controller-manager.conf certificate
[upgrade/staticpods] Moved new manifest to &ldquo;/etc/kubernetes/manifests/kube-controller-manager.yaml&rdquo; and backed up old manifest to &ldquo;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/kube-controller-manager.yaml&rdquo;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: kube-controller-manager-kubernetes1 hash: f106f0d94b93b77e4db974b1c477d277
Static pod: kube-controller-manager-kubernetes1 hash: e6e76bb8264f2e84070efada35e93e71
[apiclient] Found 1 Pods for label selector component=kube-controller-manager
[upgrade/staticpods] Component &ldquo;kube-controller-manager&rdquo; upgraded successfully!
[upgrade/staticpods] Preparing for &ldquo;kube-scheduler&rdquo; upgrade
[upgrade/staticpods] Renewing scheduler.conf certificate
[upgrade/staticpods] Moved new manifest to &ldquo;/etc/kubernetes/manifests/kube-scheduler.yaml&rdquo; and backed up old manifest to &ldquo;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/kube-scheduler.yaml&rdquo;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: kube-scheduler-kubernetes1 hash: 131c3f63daec7c0750818f64a2f75d20
Static pod: kube-scheduler-kubernetes1 hash: 8c5e33e50bb56e8adacd1cc99c56b2cb
[apiclient] Found 1 Pods for label selector component=kube-scheduler
[upgrade/staticpods] Component &ldquo;kube-scheduler&rdquo; upgraded successfully!
[upload-config] Storing the configuration used in ConfigMap &ldquo;kubeadm-config&rdquo; in the &ldquo;kube-system&rdquo; Namespace
[kubelet] Creating a ConfigMap &ldquo;kubelet-config-1.16&rdquo; in namespace kube-system with the configuration for the kubelets in the cluster
[kubelet-start] Downloading configuration for the kubelet from the &ldquo;kubelet-config-1.16&rdquo; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &ldquo;/var/lib/kubelet/config.yaml&rdquo;
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy</p>
<p>[upgrade/successful] SUCCESS! Your cluster was upgraded to &ldquo;v1.16.3&rdquo;. Enjoy!</p>
<p>[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven&rsquo;t already done so.</p>
<p>{% endhighlight %}</p>
<blockquote>
<p>We can see the cluster is upgraded to lastest version v1.16.3</p></blockquote>
<h5 id="step-7-uncordon-the-master-node">Step 7: Uncordon the master node<a hidden class="anchor" aria-hidden="true" href="#step-7-uncordon-the-master-node">#</a></h5>
<p>Now ucordon the master node</p>
<p>{% highlight console %}</p>
<p>vikki@kubernetes1:~$ kubectl uncordon kubernetes1
node/kubernetes1 uncordoned</p>
<p>{% endhighlight %}</p>
<h5 id="step-8-upgrade-the-kubelet">Step 8: Upgrade the kubelet<a hidden class="anchor" aria-hidden="true" href="#step-8-upgrade-the-kubelet">#</a></h5>
<p>Now in the previous steps we have upgraded the kubeadm and cluster , next we need to upgrade the kubelet and kubectl</p>
<p>{% highlight console %}</p>
<p>root@kubernetes1:~# apt-mark unhold kubelet kubectl &amp;&amp; \</p>
<blockquote>
<p>apt-get update &amp;&amp; apt-get install -y kubelet=1.16.3-00 kubectl=1.16.3-00 &amp;&amp; <br>
apt-mark hold kubelet kubectl
kubelet was already not hold.
kubectl was already not hold.
Hit:1 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security InRelease        <br>
Hit:2 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial InRelease
Hit:3 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates InRelease
Hit:4 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-backports InRelease
Hit:5 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial InRelease
Reading package lists&hellip; Done
Reading package lists&hellip; Done
Building dependency tree    <br>
Reading state information&hellip; Done
The following packages will be upgraded:
kubectl kubelet
2 upgraded, 0 newly installed, 0 to remove and 140 not upgraded.
Need to get 29.9 MB of archives.
After this operation, 7,134 kB of additional disk space will be used.
Get:1 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial/main amd64 kubectl amd64 1.16.3-00 [9,233 kB]
Get:2 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial/main amd64 kubelet amd64 1.16.3-00 [20.7 MB]                                                            <br>
Fetched 29.9 MB in 8s (3,436 kB/s)                                                                                                                        <br>
(Reading database &hellip; 60808 files and directories currently installed.)
Preparing to unpack &hellip;/kubectl_1.16.3-00_amd64.deb &hellip;
Unpacking kubectl (1.16.3-00) over (1.15.5-00) &hellip;
Preparing to unpack &hellip;/kubelet_1.16.3-00_amd64.deb &hellip;
Unpacking kubelet (1.16.3-00) over (1.15.5-00) &hellip;
Setting up kubectl (1.16.3-00) &hellip;
Setting up kubelet (1.16.3-00) &hellip;
kubelet set on hold.
kubectl set on hold.</p></blockquote>
<p>{% endhighlight %}</p>
<p>Restart the kubelet service</p>
<p>{% highlight console %}</p>
<p>root@kubernetes1:~# sudo systemctl restart kubelet</p>
<p>{% endhighlight %}{% highlight console %}</p>
<p>vikki@kubernetes1:~$ kubectl get nodes
NAME STATUS ROLES AGE VERSION
kubernetes1 Ready master 41d v1.16.3
kubernetes2 Ready <none> 41d v1.15.5</p>
<p>{% endhighlight %}</p>
<blockquote>
<p>Now we can see the master node kubernetes1 is upgraded to v1.16.3</p></blockquote>
<h3 id="worker-node">Worker node<a hidden class="anchor" aria-hidden="true" href="#worker-node">#</a></h3>
<h5 id="step-1-upgrade-the-kubeadm-to-version-1163">Step 1: Upgrade the kubeadm to version 1.16.3<a hidden class="anchor" aria-hidden="true" href="#step-1-upgrade-the-kubeadm-to-version-1163">#</a></h5>
<p>{% highlight console %}</p>
<p>root@kubernetes2:~# apt-mark unhold kubeadm &amp;&amp; \</p>
<blockquote>
<p>apt-get update &amp;&amp; apt-get install -y kubeadm=1.16.3-00 &amp;&amp; <br>
apt-mark hold kubeadm
kubeadm was already not hold.
Get:1 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security InRelease [109 kB]              <br>
Get:2 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security/main amd64 Packages [785 kB]    <br>
Hit:3 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial InRelease
Get:4 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates InRelease [109 kB]   <br>
Get:5 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial InRelease [161 B]
Get:6 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial/main amd64 Packages [31.3 kB]                   <br>
Get:7 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-backports InRelease [107 kB]     <br>
Get:8 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates/main amd64 Packages [1,071 kB]          <br>
Get:9 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security/main i386 Packages [617 kB]  <br>
Get:10 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security/main Translation-en [302 kB]                                                                     <br>
Get:11 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security/universe amd64 Packages [466 kB]                                                                 <br>
Get:12 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates/main i386 Packages [882 kB]                                                                     <br>
Get:13 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security/universe i386 Packages [401 kB]                                                                  <br>
Get:14 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security/universe Translation-en [191 kB]                                                                 <br>
Get:15 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security/multiverse amd64 Packages [5,724 B]                                                              <br>
Get:16 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security/multiverse i386 Packages [5,888 B]                                                               <br>
Get:17 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates/main Translation-en [413 kB]                                                                    <br>
Get:18 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates/universe amd64 Packages [771 kB]                                                                <br>
Get:19 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates/universe i386 Packages [700 kB]                                                                 <br>
Get:20 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates/universe Translation-en [324 kB]                                                                <br>
Get:21 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates/multiverse amd64 Packages [16.8 kB]                                                             <br>
Get:22 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates/multiverse i386 Packages [15.9 kB]                                                              <br>
Fetched 7,333 kB in 23s (315 kB/s)                                                                                                                        <br>
Reading package lists&hellip; Done
Reading package lists&hellip; Done
Building dependency tree    <br>
Reading state information&hellip; Done
The following packages will be upgraded:
kubeadm
1 upgraded, 0 newly installed, 0 to remove and 139 not upgraded.
Need to get 8,762 kB of archives.
After this operation, 4,062 kB of additional disk space will be used.
Get:1 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial/main amd64 kubeadm amd64 1.16.3-00 [8,762 kB]
Fetched 8,762 kB in 7s (1,122 kB/s)                                                                                                                       <br>
(Reading database &hellip; 60808 files and directories currently installed.)
Preparing to unpack &hellip;/kubeadm_1.16.3-00_amd64.deb &hellip;
Unpacking kubeadm (1.16.3-00) over (1.15.5-00) &hellip;
Setting up kubeadm (1.16.3-00) &hellip;
kubeadm set on hold.</p></blockquote>
<p>{% endhighlight %}</p>
<h5 id="step-2-drain-the-pods-in-worker-node">Step 2: Drain the pods in worker node<a hidden class="anchor" aria-hidden="true" href="#step-2-drain-the-pods-in-worker-node">#</a></h5>
<p>Now drain all the pods , except daemonsets from the worker node kubernetes2. <em>This command should be run in master node in case the kubenetes config is not mapped in worker</em>.</p>
<p>{% highlight console %}</p>
<p>vikki@kubernetes1:~$ kubectl drain kubernetes2 &ndash;ignore-daemonsets
node/kubernetes2 cordoned
WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-flannel-ds-amd64-8v6lb, kube-system/kube-proxy-877b2
evicting pod &ldquo;coredns-5644d7b6d9-t8qw5&rdquo;
evicting pod &ldquo;httpd-7765f5994-gvlj6&rdquo;
evicting pod &ldquo;nginx-7bffc778db-phdb5&rdquo;
evicting pod &ldquo;coredns-5644d7b6d9-frz4v&rdquo;
pod/coredns-5644d7b6d9-frz4v evicted
pod/coredns-5644d7b6d9-t8qw5 evicted
pod/httpd-7765f5994-gvlj6 evicted
pod/nginx-7bffc778db-phdb5 evicted
node/kubernetes2 evicted</p>
<p>{% endhighlight %}</p>
<h5 id="step-3-upgrade-the-worker-node">Step 3: Upgrade the worker node<a hidden class="anchor" aria-hidden="true" href="#step-3-upgrade-the-worker-node">#</a></h5>
<p>{% highlight console %}</p>
<p>root@kubernetes2:~# sudo kubeadm upgrade node
[upgrade] Reading configuration from the cluster&hellip;
[upgrade] FYI: You can look at this config file with &lsquo;kubectl -n kube-system get cm kubeadm-config -oyaml&rsquo;
[upgrade] Skipping phase. Not a control plane node[kubelet-start] Downloading configuration for the kubelet from the &ldquo;kubelet-config-1.16&rdquo; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &ldquo;/var/lib/kubelet/config.yaml&rdquo;
[upgrade] The configuration for this node was successfully updated!
[upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.</p>
<p>{% endhighlight %}</p>
<h5 id="step-4-upgrade-the-kubelet-and-kubectl">Step 4: Upgrade the kubelet and kubectl<a hidden class="anchor" aria-hidden="true" href="#step-4-upgrade-the-kubelet-and-kubectl">#</a></h5>
<p>In previous steps we upgraded the kubeadm and cluster. Now we need to upgrade the kubelet and kubectl.</p>
<p>{% highlight console %}</p>
<p>root@kubernetes2:~# apt-mark unhold kubelet kubectl &amp;&amp; \</p>
<blockquote>
<p>apt-get update &amp;&amp; apt-get install -y kubelet=1.16.3-00 kubectl=1.16.3-00 &amp;&amp; <br>
apt-mark hold kubelet kubectl
kubelet was already not hold.
kubectl was already not hold.
Hit:1 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> xenial-security InRelease
Hit:2 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial InRelease                    <br>
Hit:3 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-updates InRelease
Hit:4 <a href="http://us.archive.ubuntu.com/ubuntu">http://us.archive.ubuntu.com/ubuntu</a> xenial-backports InRelease
Hit:5 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial InRelease
Reading package lists&hellip; Done
Reading package lists&hellip; Done
Building dependency tree    <br>
Reading state information&hellip; Done
The following packages will be upgraded:
kubectl kubelet
2 upgraded, 0 newly installed, 0 to remove and 137 not upgraded.
Need to get 29.9 MB of archives.
After this operation, 3,447 kB of additional disk space will be used.
Get:1 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial/main amd64 kubectl amd64 1.16.3-00 [9,233 kB]
Get:2 <a href="https://apt.kubernetes.io">https://apt.kubernetes.io</a> kubernetes-xenial/main amd64 kubelet amd64 1.16.3-00 [20.7 MB]                                                            <br>
Fetched 29.9 MB in 32s (934 kB/s)                                                                                                                         <br>
(Reading database &hellip; 60808 files and directories currently installed.)
Preparing to unpack &hellip;/kubectl_1.16.3-00_amd64.deb &hellip;
Unpacking kubectl (1.16.3-00) over (1.16.2-00) &hellip;
Preparing to unpack &hellip;/kubelet_1.16.3-00_amd64.deb &hellip;
Unpacking kubelet (1.16.3-00) over (1.15.5-00) &hellip;
Setting up kubectl (1.16.3-00) &hellip;
Setting up kubelet (1.16.3-00) &hellip;
kubelet set on hold.
kubectl set on hold.</p></blockquote>
<p>{% endhighlight %}</p>
<p>Restart the kubelet service in worker node</p>
<p>{% highlight console %}</p>
<p>root@kubernetes2:~# sudo systemctl restart kubelet</p>
<p>{% endhighlight %}</p>
<h5 id="step-5-uncordon-the-worker-node">Step 5: Uncordon the worker node<a hidden class="anchor" aria-hidden="true" href="#step-5-uncordon-the-worker-node">#</a></h5>
<p>Now uncordon all the pods in kubernetes2 worker onde</p>
<p>{% highlight console %}</p>
<p>vikki@kubernetes1:~$ kubectl uncordon kubernetes2
node/kubernetes2 uncordoned</p>
<p>{% endhighlight %}{% highlight console %}</p>
<p>vikki@kubernetes1:~$ kubectl get nodes
NAME STATUS ROLES AGE VERSION
kubernetes1 Ready master 41d v1.16.3
kubernetes2 Ready <none> 41d v1.16.3</p>
<p>{% endhighlight %}</p>
<blockquote>
<p>We can see now both the master and worker nodes are upgraded from v1.15.5 to v1.16.3</p></blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/kubernetes/">Kubernetes</a></li>
      <li><a href="http://localhost:1313/tags/linux/">Linux</a></li>
      <li><a href="http://localhost:1313/tags/opensource/">Opensource</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/2019-11-28-rbac-in-kubernetes/">
    <span class="title">« Prev</span>
    <br>
    <span>RBAC in kubernetes</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/2019-11-25-running-kubernetes-custom-scheduler/">
    <span class="title">Next »</span>
    <br>
    <span>Running kubernetes custom scheduler</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Upgrading kubernetes cluster master and worker nodes on x"
            href="https://x.com/intent/tweet/?text=Upgrading%20kubernetes%20cluster%20master%20and%20worker%20nodes&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes%2f&amp;hashtags=kubernetes%2clinux%2copensource">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Upgrading kubernetes cluster master and worker nodes on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes%2f&amp;title=Upgrading%20kubernetes%20cluster%20master%20and%20worker%20nodes&amp;summary=Upgrading%20kubernetes%20cluster%20master%20and%20worker%20nodes&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2f2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Upgrading kubernetes cluster master and worker nodes on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes%2f&title=Upgrading%20kubernetes%20cluster%20master%20and%20worker%20nodes">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Upgrading kubernetes cluster master and worker nodes on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Upgrading kubernetes cluster master and worker nodes on whatsapp"
            href="https://api.whatsapp.com/send?text=Upgrading%20kubernetes%20cluster%20master%20and%20worker%20nodes%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2f2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Upgrading kubernetes cluster master and worker nodes on telegram"
            href="https://telegram.me/share/url?text=Upgrading%20kubernetes%20cluster%20master%20and%20worker%20nodes&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Upgrading kubernetes cluster master and worker nodes on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Upgrading%20kubernetes%20cluster%20master%20and%20worker%20nodes&u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2019-11-26-upgrading-kubernetes-cluster-master-and-worker-nodes%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Vignesh Ragupathy</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
